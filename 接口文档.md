# Development Board Interface Documentation (接口文档)

## 1. Introduction
### 简介
**绿邮® X系列开发板**是一款全功能的嵌入式双卡双待4G全网通开发板，基于C/C++和部分汇编开发。
  
使用**绿邮® X系列开发板**进行二次开发，不用考虑电压、信号、底层协议等繁琐的技术细节，可以简便的与各种高级语言（如Java、C#、Asp.net、Perl、PHP等）进行对接。
  
**绿邮® X系列开发板**将底层细节封装成了HTTP或TCP协议，以Form或Json格式与您的接口进行数据交互。开发板适用于各种行业，如政务、应急救援、保险、自动告警、移动通信等，可以帮助您快速开发新产品。

<center>  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=2c1489f991753a8055a88560c3bbccfe)</center>




### 开发板硬件介绍
### 开发板硬件实物图
（**主板布局图**）：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=0ec34fe5c14413985802084709c3d89a)</center>

### 开发板硬件各部分说明：
X5开发板尺寸为 105mm * 84mm，板上自带WiFi天线、4G LTE天线、4G模组以及多个M2螺丝孔，支持安装M2六角接线柱。
  
**位置①：**开发板的电源接口。电源接口与最常见的安卓手机接口一样，采用的是TypeC接口，如下图：
<center> ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=7d0e920f6bdbac862288d4cd837fedc7)</center>

开发板可以连接普通安卓手机的电源头。注意，电源头必须要符合5v2A规格，即电源的电压必须是5v，电流至少要2A以上。（新一代支持快充的安卓电源，通常会同时标注：5v3A、9v2A等多种规格，只要标注了5v通常就可以使用。）
  
    **位置②：**开发板的SIM卡插槽。开发板支持同时插入二张SIM卡，支持双卡双待。使用时将SIM卡插入到卡槽中就可以了。SIM卡槽可以插入“nano”卡（小卡），小卡实物图如下：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=23e5c5e64cef39ab5c369bc25f174a31)</center>
   
**位置③：**开发板的显示屏接口。显示屏是可选组件，使用时即插即用。显示屏可以提示开发板运行中的一些关键信息，如WiFi链接状态以及IP地址、SIM卡当前状态等信息。显示屏的实物图如下：
  
<center>  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=d3e330b79c2d87d7284ceaa60199102b)</center>


### 什么是控制命令
### 什么是控制命令？
**控制命令**是由您（或接口）主动发送给开发板，通知开发板执行对应的操作。相应的，开发板收到“命令”并执行，执行的结果以“消息”的方式反馈给您（或接口）。
```seq
您的接口-开发板:->     控制命令     ->
开发板--您的接口:<-     推送消息     <-
```

### 控制指令的示例
以获取**开发板当前状态(stat)**的命令为例，说明控制命令的构成：
  ```
  http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=stat
  ```
   `http://192.168.7.170/ctrl`这是控制命令的固定开头。其中`192.168.7.170`是开发板的当前IP地址，实际使用中需要替换成您的开发板真实的IP地址。
   `?token=3f4bffa77257d243875d0a5a80635934`**token**所有控制命令的所必须的一个参数，具体**token**的获取方法，请参阅**安全模型与token机制**的相关章节。
   `&cmd=stat`**cmd**是控制命令所必须的另一个参数。用于指明开发板具体执行什么动作。
   
   这条**控制命令**的作用是，获取开发板当前的各项状态，您可以尝试在浏览器上输入这个URL，之后开发板会以JSON格式返回当前自身的状态信息，示例如下：
   
 ``` 
 {
  "devId": "498060912345",  //当前开发板唯一ＩＤ
  "schRstHour": 4,			//开发板每日定时重启时间，默认凌晨4点
  "pingSec": 110,			//开发板主动推送PING消息（998）的间隔秒数
  "wifi": {
    "ssid": "mywifi",		//当前连入的WIFI热点名
    "ip": "192.168.7.170",	//当前开发板的IP地址
    "dbm": 21				//当前WIFI的信号强度
  },
  "slot": {
    "slot1_sta": "ERR",		//卡槽1通信模组状态：异常（不可识别）
    "slot2_sta": "POWON",	//卡槽2通信模组状态：正常开机
    "sim2_op": "T",			//卡槽2中SIM卡所属运营商：中国电信
    "sim2_dbm": "99",		//卡槽2中SIM卡的信号强度：99%
    "sim2iccId": "89860321745322212345",	//卡槽2中SIM卡的ICCID
    "sim2_sta": "OK"		 //卡槽2中SIM卡的当前状态：正常就绪
  },
  "time":"220618101522"		//开发板当前时间yymmddhhmmss
} 

 ```
   如果您使用TCP接口与设备通信，可以用下面的消息获取设备状态：
   ```
   {"cmd":"stat", "tid":"1234"}\x11\x12
   ```
   注意：TCP接口通信时，每一条消息最后都必须附加2个字节的结束符，用于表示消息的结束。2个字节的结束符必须是0x11 0x12。即结束符第一个字节是0x11，第二个字节是0x12。
   ```
   注意：
   0x11 0x12 分别代表2个字节，不要写成字符串。
   ```




## 2. Security & Token

### 安全模型与token机制
### 安全模型概要
绿邮®开发板支持二层权限管理体系，即管理员权限 和 用户权限。管理员权限高于用户权限，例如，通过管理员权限可以修改用户密码。
  
管理员权限主要用于登录开发板后台WEB页面，进行开发板底层的用户接口、运行参数等相关配置；用户权限主要是对开发板的日常运行进行查询维护，如查询开发板的运行状态、添加新的WiFi热点信息、重启开发板等。
  
管理员用户名固定为admin，密码出厂默认为admin，后续可以通过开发板的后台WEB页面进行修改。用户权限不允许登录后台WEB页面，用户权限也没有默认的用户名，只有用户密码。用户密码出厂默认为000000。
  
### token机制
通过HTTP向开发板发送**控制指令**时，必须携带token参数。token参数的取值一般可以在登录WEB后台页面，进入“密码管理”子页面中查询：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=2b0729df2552bb2d1f5a703aa340ac12)</center>
除了通过后台页面查询token之外，您可以自行计算token的取值。token的计算方法如下：
1. 将管理员名、密码拼接为字符串，中间以竖线“|”分隔。例如：`admin|admin`
2. 计算拼接字符串的MD5值转为16进制，即可获得token。




---

## 3. Control Commands (HTTP/TCP)

### 3.1 Device Control

#### chpwduser - 修改用户密码
### “命令：chpwduser - 修改用户密码”使用说明
#### 命令的作用
使用chpwduser指令，可以修改用户密码。
#### 命令的格式（HTTP方式示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=chpwduser&p1=000000
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"chpwduser", "p1":"000000", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | chpwduser |字符型|控制命令名称|
|p1 |000000 |字符型|新用户密码（不能少于4个字符）|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无





#### now - 设置开发板时间
### “命令：now  - 为开发板设置时间”使用说明
#### 命令的作用
使用now命令，可以为开发板设置当前时间。

为开发板设置时间，一般有二种途径：
  
1、接口端向开发板发出“now”命令，并在“p1”参数中携带当前时间。开发板收到接口下发的时间后，会立即以“p1”参数中的时间，重新校准自身的时间。
  
2、如果接口下发的“now”命令中，没有携带“p1”参数时，由根据开发板的默认设置，开发板如果已经连入WIFI，则会通过WIFi向NTP服务器（全球时间校准服务器）请求当前时间。如果开发板未连入WIFI，则开发板会通过通讯模组向运营商请求当前时间。
  
注意：开发板默认当前时区为北京时间（+8时区），如需更改时区，可在“now”中指定“p3”参数，以对开发板的时区进行校准。
  
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=now&p1=20221015103005&p2=15&p3=8
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"now", "p1":"20221015103005", "p2":15, "p3":8, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | now |字符型|控制命令名称|
|p1  | 20221015103005 |字符型|当前时间。格式：年年年年月月日日时时分分秒秒（省略时由开发板自动获取时间）|
|p2| 15 |数值型|是否允许开发板自动校准时间。0：不允许自动校时；15：允许自动校时（默认）；（一般无需给出p2参数）
|p3| 8 |数值型|当前时区。8：中国时区（默认）；（中国使用时，无需给出p3参数）
|tid   | 任意值 |字符型|仅TCP接口方式可用。可为任意值，但不可省略|
#### 命令反馈结果
成功时返回：
无

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无








#### stat - 获取开发板状态
### “命令：stat  - 获取开发板当前状态”使用说明
#### 命令的作用
使用stat命令，可以获取到开发板的当前所有的状态信息。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=stat
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"stat", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | stat |字符型|控制命令名称|
|tid   | 任意值 |字符型|仅TCP接口方式可用。可为任意值，但不可省略|
#### 命令反馈结果
成功时返回：
 ```
 {
  "devId": "498060912345",
  "hwVer": "Y57v671",
  "dailyRst": 4,
  "dailyOTA": 3,
  "pingSec": 110,
  "netCh": 0,
  "wifi": {
    "ssid": "mywifi",
    "ip": "192.168.7.170",
    "dbm": 24
  },
  "slot": {
    "netOrder":[1,2],
    "slot1_sta": "ERR",
    "slot2_sta": "POWON",
    "slot2_ati": "EC600NCNLAR03A11M08",
    "sim2_op": "T",
    "sim2_dbm": "78",
    "sim2_iccId": "89860321745322288888",
    "sim2_imsi": "46007337111234",
    "sim2_msIsdn": "+8613206411822",
    "sim2_sta": "OK"
  }
  "devTime": "220420184724",
  "type": 999,
} 

 ```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |------------ |-----|--|
|devId |498060912345 |字符型|开发板的唯一ID|
|hwVer| Y57v671 |字符型|开发板的固件版本号|
|dailyRst  | 4 |数值型|开发板每日定时自动重启的时间。默认值4，有效值0~23。|
|dailyOTA  | 3 |数值型|开发板每日定时自动OTA升级的时间。默认值3，有效值0~23。|
|pingSec  | 110 |数值型|向接口循环推送消息998的周期间隔（秒）。默认值110，最小值10。|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|netOrder  | [1,2] |数值数组型|TCP接口方式中，如未连入WIFI，则根据本参数指定的卡槽顺序，尝试使用手机卡网络。|
|wifi -> ssid  | mywifi |字符型|开发板已经连入的WIFI热点名称。|
|wifi -> ip  | 192.168.7.170 |字符型|开发板当前的IP地址。|
|wifi -> dbm  | 24 |数值型|开发板当前连入WIFI热点的信号强度（百分比）。|
|slot -> slot1_sta  | ERR |字符型|卡槽1的当前状态。参见下方的参数说明。|
|slot -> slot2_sta  | POWON |字符型|卡槽2的当前状态。|
|slot -> slot2_ati  | EC600NCNLAR03A11M08 |字符型|卡槽2通信模组的固件版本号。|
|slot -> sim2_op  | T|字符型|卡槽2中SIM卡，所属的运营商。|
|slot -> sim2_dbm  | 78 |数值型|卡槽2中SIM卡的信号强度（百分比）。|
|slot -> sim2_iccId  | 89860321745322288888 |字符型|卡槽2中SIM卡的ICCID。|
|slot -> sim2_imsi  | 46007337111234 |字符型|卡槽2中SIM卡的IMSI。|
|slot -> sim2_msIsdn  | +8613206411822 |字符型|卡槽2中SIM卡的电话号码。|
|slot -> sim2_sta  | OK |字符型|卡槽2中SIM卡的当前状态。参见下方的参数说明。|
|devTime|220420184724|数值型|开发板的当前时间（年年月月日日时时分分秒秒）
|type|999|数值型|消息分类（应答类消息）

#### 关于slot[1|2]_sta参数的说明
| 参数值  |说明|
| -------- |---------- |
|ERR |卡槽识别错误。可能的原因：1、通信模组未插入；2、通信模组损坏；3、通信模组未获支持。|
|NOSIM |卡槽正常开机，但卡槽中没有插入有效的SIM卡。|
|POWON |卡槽正常开机，SIM卡正常可用。|
|POWOFF |卡槽没有开机。|

#### 关于sim[1|2]_sta参数的说明
| 参数值  |说明|
| -------- |---------- |
|OK |SIM卡工作正常。|
|PUK |SIM卡上有PUK密码。|
|NS |SIM卡无服务。|
|LT |SIM卡已被限制服务。|

#### 关于sim[1|2]_op参数的说明
| 参数值  |说明|
| -------- |---------- |
|C |中国移动|
|U |中国联通|
|T |中国电信
|X |境外卡？|
|N |识别失败|






#### restart - 重启开发板
### “命令：restart - 重启开发板”使用说明
#### 命令的作用
使用 restart 命令，可以重启开发板。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=restart
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"restart", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | restart |字符型|控制命令名称|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
无

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






#### pingsec - 修改ping间隔秒数
### “命令：pingsec - 修改ping间隔秒数”使用说明
#### 命令的作用
使用 pingsec 命令，可以修改PING消息（推送消息998）的周期间隔秒数。此值修改后，需要重启开发板后方能生效。
在HTTP接口方式中，此命令可以在WEB控制台上禁止推送。
在TCP接口方式中，为了维持网络连接，此命令强制必须推送。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=pingsec&p1=60
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"pingsec", "p1":60, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | pingsec |字符型|控制命令名称|
|p1 |60 |数值型|间隔秒数，最小值10。|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






#### dailyrst - 设置每日重启时间
### “命令：dailyrst - 设置每日重启时间”使用说明
#### 命令的作用
使用 dailyrst 命令，可以让开发板在每天的固定时段自动重启一次。
默认值是4，表示每天4点自动重启。参数中只能指定小时，分钟随机。
>注意
一般来说，我们强烈不建议关闭设备的每日自动重启功能。因为，允许设备每日在空闲时段自动重启一次，将有利于设备的长期稳定运行。

#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=dailyrst&p1=4
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"dailyrst", "p1":4, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | dailyrst |字符型|控制命令名称|
|p1 |4 |数值型|开发板每天自动重启的时间。0~23表示时段。取值大于23（如25）则表示关闭每日重启|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






### 3.2 Slot Control

#### slotoff - 指定卡槽关机
### “命令：slotoff - 指定卡槽停机”使用说明
#### 命令的作用
使用 slotoff 命令，可以让开发板上的某个卡槽进入关机状态。
卡槽关机之后，会执行运营商基站的完整“注销”流程。向已经被关机的卡槽拨入电话时，提示音通常是：您所拨打的电话已关机 或 您所拨打的电话暂时无法接通。
  
当您把手机卡重新插入到卡槽后，已经被关机的卡槽将被自动唤醒，并重新进入工作状态。
  
>注意：
当设备重启时，已经关机的卡槽也将被唤醒，并重新进入开机工作状态。需要特别注意的是设备每日的自动重启设置，当设备触发了每日自动重启后，所有已经关机的卡槽都将被唤醒。
如果需要使用卡槽关机的功能，请务必将每日重启的设置调整到合理的时间段，或关闭每日自动重启功能。

#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=slotoff&p1=1
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"slotoff", "p1":"1", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | slotoff |字符型|控制命令名称|
|p1 |1 |数值型|卡槽号。1表示卡槽1；2表示卡槽2|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






#### slotrst - 指定卡槽重启
### “命令：slotrst - 指定卡槽重启”使用说明
#### 命令的作用
使用 slotrst 命令，可以让开发板上的某个卡槽重新启动。重新启动过程，一般需要60秒左右的时间。命令发出后，相当于用户手动将开发板上的SIM卡弹出后，又重新插入SIM卡。
  
正常情况下，您接口会在卡槽重启的过程中，陆续接收到开发板推送的202、203、204推送消息。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=slotrst&p1=1
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"slotrst", "p1":"1", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | slotrst |字符型|控制命令名称|
|p1 |1 |数值型|卡槽号。1表示卡槽1；2表示卡槽2|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无







#### slotplmn - 指定卡注册的运营商
### “命令：slotplmn - 指定卡槽注册的运营商代码”使用说明
#### 命令的作用
此命令一般用于境外卡。境外卡在国内落地时，通常可以选择多个运营商，比如有的境外卡允许在国内通过中国移动落地，也可以通过中国联通落地。
  
多数情况下，开发板会“自动”完成运营商的落地注册。比如某张卡自动落地为中国移动，有些时间我们希望卡注册到其它运营商（比如中国联通），而非“自动”注册的中国移动。这种情况下，我们可以通过本命令手动指定卡槽落地时的运营商代码。
  
常见的落地代码是：46000（中国移动）、46001（中国联通）、46003（中国电信）
  
>注意：
1）通过slotplmn设置完落地代码后，重启方可生效。
2）此处指定的是卡槽的落地代码，不是SIM卡的落地代码。如果您指定了卡槽1的落地代码，务必将需要特殊落地的手机卡，插到对应的卡槽1中。
3）落地代码是做SIM卡注册时的“优先尝试”，而非唯一尝试。比如：如果您指定为：46000，表示落地时优先尝试中国移动，但是在注册的过程中，中国移动无法接受您的卡注册，则开发板会自动重新搜索其它运营商进行注册。

#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=slotplmn&p1=1&p2=46000
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"slotplmn", "p1":"1", "p2":"46000", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | slotplmn |字符型|控制命令名称|
|p1 |1 |数值型|卡槽号。1表示卡槽1；2表示卡槽2|
|p2 |46000 |字符型|指定的运营商代码。0：表示恢复为“自动”|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无







### 3.3 WiFi Control

#### wf - 打开或关闭wifi
### “命令：wf - 打开或关闭wifi”使用说明
#### 命令的作用
使用 wf 命令，可以打开或关闭开发板的WIFI，也可以查询当前开发板的WIFI状态及信号强度。
**注意：** 只推荐在TCP模式中使用这个控制命令。TCP模式中，开发板支持手机卡网络与WIFI网络双通道，所以，当通过本命令关闭了开发板的WIFI功能之后，开发板会自动尝试通过手机卡网络连接到您的后台接口。
由于HTTP模式仅支持WIFI联网，所以如果在HTTP模式中发送本命令，开发板会立即处于断网的状态，从而导致无法与后台接口正常通信。
遇到这种情况时，您可以通过发送“短信命令”，重新开启开发板的WIFI功能。或者尝试将开发板恢复为“出厂设置”也可以。
  
#### 命令的格式（打开WIFI示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=wf&p1=on
```
#### 命令的格式（打开WIFI TCP方式示例）
```
{"cmd":"wf", "p1":"on", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | wf |字符型|控制命令名称|
|p1 |wifi功能状态 |字符型|on:表示开启WIFI；off:表示关闭WIFI|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|

#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无







#### addwf - 增加wifi热点信息
### “命令：addwf - 增加可连入的wifi热点信息”使用说明
#### 命令的作用
使用 addwf 命令，可以为开发板增加可以连入的WIFI热点信息。
您可以为开发板指定多个WIFI热点信息，开发板会根据附近的WIFI热点清单，自动选择信号最佳的热点进行连接。
开发板中可以存储多组WIFI热点信息，数量一般没有上限。
**注意，WIFI热点必须是2.4G制式。**
  
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=addwf&p1=wifi热点名&p2=wifi热点密码
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"addwf", "p1":"wifi热点名", "p2":"wifi热点密码", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | addwf |字符型|控制命令名称|
|p1 |wifi热点名 |字符型|可连入的WIFI热点名|
|p2 |wifi热点密码 |字符型|可连入的WIFI热点密码|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|

#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






#### delwf - 删除wifi热点信息
### “命令：delwf - 删除可连入的wifi热点信息”使用说明
#### 命令的作用
使用 delwf 命令，可以将开发板中可以连入的WIFI热点信息删除掉。
您可以为开发板指定多个WIFI热点信息，开发板会根据附近的WIFI热点清单，自动选择信号最佳的热点进行连接。
开发板中可以存储多组WIFI热点信息，数量一般没有上限。
**注意，WIFI热点必须是2.4G制式。**
  
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=delwf&p1=wifi热点名
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"delwf", "p1":"wifi热点名", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | delwf |字符型|控制命令名称|
|p1 |wifi热点名 |字符型|可连入的WIFI热点名|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|

#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无







### 3.4 SMS Functions

#### sendsms - 外发短信
### “命令：sendsms - 控制SIM卡外发短信”使用说明
#### 命令的作用
使用 sendsms 命令，可以控制开发板的某个卡槽中的SIM卡，向外发送短信。
  
如果您的接口需要获取**短信发外成功报告**，那么您需要在控制命令中增加tid参数，并为其添加一个唯一ID（一般推荐使用timestamp即可）。
当短信外发成功后，您的接口将接收到开发板推送的501消息。501消息中tid参数，与您在控制命令中提供的tid参数一致。

```plantuml
@startuml
用户接口 -> 开发板: 控制命令:sendsms (tid=123456)
用户接口 <-- 开发板 :   推送消息:501 (tid=123456)
@enduml
```

sendsms控制消息中，tid参数不可以省略。
  
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=sendsms&tid=1647344840&p1=2&p2=10001&p3=查话费
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"sendsms", "p1":2, "p2":"10001", "p3":"查话费", "tid":"1647344840"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | sendsms |字符型|控制命令名称|
|p1 |2 |数值型|外发短信的卡槽号|
|p2 |10001 |字符型|短信号码|
|p3 |查话费 |字符型|短信内容|
|tid   | 任意值 |字符型|不可省略。控制命令的唯一标识，用于接收501消息（短信外发成功报告）|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






#### querysms - 查询本地短信库
### “命令：querysms - 查询本地短信库”使用说明
#### 命令的作用
开发板本身可以滚动存储最近的100条短信。通过 querysms 命令，可以查询开发板本地存储的最近100条短信记录。
  
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=querysms&p1=1&p2=10
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"querysms", "p1":1, "p2":10}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | querysms |字符型|控制命令名称|
|p1 |1 |数值型|从第几条短信开始查询（offset）|
|p2 |10 |数值型|共查询多少条（rows On Page）|
|p3 |话费余额 |字符型|限制查询的短信内容关键字（省略查所有）|
#### 命令反馈结果
成功时返回：
```
{
  "subType": 30,
  "code": 0,
  "qkey": "",
  "offset": "1",
  "limit": "10",
  "results": [
    {
      "slot": 1,
      "dir": 0,
      "phNum": "10691021560051",
      "smsBd": "【火山引擎】尊敬的用户，…………",
      "smsTs": 1751453195
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "10691009096368",
      "smsBd": "【河北银行】您尾号7525的信用卡…………",
      "smsTs": 1751428444
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "95555",
      "smsBd": "【招商银行】张三于07月02日07:56向贵账户7524发起2121.00元的转账，请注意查收.",
      "smsTs": 1751417021
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "10680786600000009587",
      "smsBd": "【贝锐】您正在验证向日葵帐号的登录操作，验证码：502519。",
      "smsTs": 1751360771
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "106305792292",
      "smsBd": "【深度求索】验证码：517351，有效期 5 分钟，如非本人操作，请忽略。",
      "smsTs": 1751359963
    }
  ],
  "devId": "e51e9881265a3c8",
  "type": 402,
  "netCh": 0,
  "msgTs": 1751460187
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
1）查询的短信结果，保存在results字段（集合）中。
  
2）p1参数指定从短信库的第几条开始查询（最值是1）， p2参数指定共查询多少条。
比如：当您需要分页查询，每页5条短信记录。查询第1页时，需要发送参数：
  <center>```p1=1(从第1条开始查询)；p2=5(共查询5条) ```</center>
查询第2页时，需要发送参数：
    <center>```p1=6(从第1条开始查询)；p2=5(共查询5条) ```</center>
依次类推。
  
3）当results字段中返回的记录数大于p2指定的查询条数时，表示后面还有更多记录可以查询。
比如：指定参数：p1=1, p2=5。返回的查询结果中results的记录数是6，表示本页查询完成后，后面还有更多的短信记录，可以继续查询。
同样的，如果指定参数：p1=1, p2=5。返回的查询结果中results的记录数是5 或 小于5。则表示本页面已经是最后一页了。后面没有更多短信记录了。
  
4）本地短信库是按短信时间“降序保存”的，即最后收到的短信，总是出现在短信库的第1页的第1条。如果您需要查询短信库中最近的5条记录，则指定的参数总是：
  <center>```p1=1(从第1条开始查询)；p2=5(共查询5条) ```</center>
这样的话，querysms命令总是返回开发板最近收到的5条短信记录。
  
5）返回记录的结果的各字段意义解释：
```json
  "results": [
    {
      "slot": 1,	//卡槽号。1表示卡槽一
      "dir": 1,		//短信方向。 0表示收到的短信；1表示发出的短信
      "phNum": "053256894747",		//短信号码
      "smsBd": "【河北银行】您尾号7525的信用卡…………",
      "smsTs": 1751428444		//短信时间戳
    }]
```





### 3.5 Call Functions

#### 通话指令概述
### 开发板可以实现互联网通话（Voice over Internet Protocol / VoIP）吗？
不能。受法律法规的限制，开发板不提供VoIP相关的开发接口。这意味着您无法通过开发，实现将电话卡的通话语音，通过网络进行传递，从而实现网络接打电话的功能。
  
### 开发板提供“通话指令”的目的是什么？
开发板提供了完整的通话接口，包括电话拨打、电话接听、电话挂断，以及通话中播放机器语音内容的相关开发接口。通过这些开发接口，您可以实现类似于“电话机器人”的功能。一般典型的应用包括：
  - IVR语音导航：
类似于您拨打10086号，由移动公司提供的自动语音导航功能： 按（1）查询话费余额； 按（2）查询流量…… 等。并由此扩展，您可以定制自己的IVR语音导航机器人，从而实现类似于自动订单查询、自动业务数据查询等类似的应用。

  - 自动语音报警机器人：
类似于您后台自动检测某些报警数据，当发生严重警情时，您可以通过设备的电话语音功能，实现自动的电话报警。比如：当机房中的温度传感器大于65度，则自动拨打管理员的报警手机，管理员接听后，由开发板自动向管理员手机播放当前警情信息。




#### teldial - 电话拨号
### “命令:teldial - 控制卡槽向外拨打电话”使用说明
#### 命令的作用
使用 teldial 命令，可以控制设备的某个卡槽，向外拨打电话。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=teldial&p1=1&p2=13206411822&p3=55&p4=拨通后播放的TTS语音内容&p5=2&p6=1&p7=1
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"teldial", "p1":1, "p2":"13206411822", "p3":55, "p4":"拨通后播放的TTS语音内容", "p5":2, "p6":1, "p7":1, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | teldial |字符型|控制命令名称|
|p1 |1 |数值型|拨号的卡槽号。（1：卡一；2：卡二）|
|p2 | 13206411822 | 字符型 | 拨打的电话号码 |
|p3 | 55 | 数值型 | 通话总时长（秒）。到达后，主动挂断电话。默认值：175秒|
|p4 | 拨通后播放的TTS语音内容 | 字符型 | 电话拨通后向对方播放的TTS语音内容 |
|p5 | 2 | 数值型 | TTS语音播放的次数。（标识TTS共播放几轮）|
|p6 | 1 | 数值型 | 暂停时间。一轮TTS播放完成后，暂停多少秒，再开始下一轮播放|
|p7 | 1 | 数值型 | TTS全部播放完成后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无




#### telanswer - 接听来电
### “命令:telanswer - 控制卡槽接听来电”使用说明
#### 命令的作用
使用 telanswer 命令，可以控制设备的某个卡槽，接听正在响铃中的来电。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telanswer&p1=1&p2=55&p3=拨通后播放的TTS语音内容&p4=2&p5=1&p6=1
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"telanswer", "p1":1, "p2":55, "p3":"拨通后播放的TTS语音内容", "p4":2, "p5":1, "p6":1, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telanswer |字符型|控制命令名称|
|p1 |1 |数值型|接听来电的卡槽号。（1：卡一；2：卡二）|
|p2 | 55 | 数值型 | 通话总时长（秒）。到达后，主动挂断电话。默认值：175秒|
|p3 | 拨通后播放的TTS语音内容 | 字符型 | 电话接通后向对方播放的TTS语音内容 |
|p4 | 2 | 数值型 | TTS语音播放的次数。（标识TTS共播放几轮）|
|p5 | 1 | 数值型 | 暂停时间。一轮TTS播放完成后，暂停多少秒，再开始下一轮播放|
|p6 | 1 | 数值型 | TTS全部播放完成后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无





#### telhangup - 电话挂机
### “命令:telhangup - 控制卡槽挂断当前通话”使用说明
#### 命令的作用
使用 telhangup 命令，可以控制设备的某个卡槽，立即挂断当前的通话。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telhangup&p1=1
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"telhangup", "p1":1, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telhangup |字符型|控制命令名称|
|p1 |1 |数值型|执行挂机的卡槽号。（1：卡一；2：卡二）|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无




#### telstarttts - 播放TTS语音
### “命令:telstarttts - 通话中向对方播放TTS语音”使用说明
#### 命令的作用
使用 telstarttts 命令，当某个卡槽处于通话中的状态时，可以通过本命令向对方播放指定的TTS语音内容。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telstarttts&p1=1&p2=拨通后播放的TTS语音内容&p3=2&p4=1&p5=0
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"telstarttts", "p1":1, "p2":"拨通后播放的TTS语音内容", "p3":2, "p4":1, "p5":0, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telstarttts |字符型|控制命令名称|
|p1 | 1 |数值型|播放语音的卡槽号。（1：卡一；2：卡二）|
|p2 | 拨通后播放的TTS语音内容 | 字符型 | 电话拨通后向对方播放的TTS语音内容 |
|p3 | 2 | 数值型 | TTS语音播放的次数。默认值：0（不限次数）|
|p4 | 1 | 数值型 | 暂停时间。一轮TTS播放完成后，暂停多少秒，再开始下一轮播放|
|p5 | 0 | 数值型 | TTS全部播放完成后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无





#### telstoptts- 停止播放TTS语音
### “命令:telstoptts - 通话中停止正在播放的TTS语音”使用说明
#### 命令的作用
使用 telstoptts 命令，当某个卡槽处于通话中的状态时，可以通过本命令停止正在播放的TTS语音内容。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telstoptts&p1=1&p2=0
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"stoptts", "p1":1, "p2":0, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telstoptts |字符型|控制命令名称|
|p1 | 1 |数值型|拨号的卡槽号。（1：卡一；2：卡二）|
|p2 | 0 | 数值型 | TTS停止播放后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






#### telkeypress - 本地电话按键
### “命令:telkeypress - 默认本机电话按键”使用说明
#### 命令的作用
使用 telkeypress 命令，可以模拟本机的电话按键。
比如当您控制开发板拨打10086时，对方语音提示：按1查余额，按2查账单。此时，您可以控制开发板发送本机按键 1 或 2，进入10086语音导航的其它环节。
>注意：
（1）有效的按键包括：0-9, A, B, C, D, *, #
（2）多个按键序列之间，可以插入暂停符。暂停符一共有4个，分别是：p、 P、 m、 M
p (小写）表示：暂停1000毫秒（1秒）；
P (大写）表示：暂停5000毫秒（5秒）；
m (小写) 表示：暂停100毫秒（0.1秒）；
M (大写) 表示：暂停500毫秒（0.5秒）；
比如发送按键序列：http:// ... cmd=telkeypress&p1=1&p2=13255668899P1pp2mM3
表示控制开发板向对方发送以下按键：
按键：13255668899
（1个P，暂停5秒后）
按键：1
（2个p，暂停2秒后）
按键：2
（mM两个暂停符，暂停0.6秒后）
按键：3

#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telkeypress&p1=1&p2=1
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"telkeypress", "p1":1, "p2":"1", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telkeypress |字符型|控制命令名称|
|p1 |1 |数值型|拨号的卡槽号。（1：卡一；2：卡二）|
|p2 | 1 | 字符型 | 模拟本地按键的按键序列（可以是多个字符） |
|p3 | 200 | 数值型 | 按键音时长（毫秒）。默认值：200毫秒|
|p4 | 100 | 数值型 | 多个按键音之间间隔毫秒数。默认值：100毫秒 |
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无





#### querytel - 查询本地通话记录
### “命令：querytel - 查询本地通话记录”使用说明
#### 命令的作用
开发板本身可以滚动存储最近的50条通话记录。通过 querytel 命令，可以查询开发板本地存储的最近50条通话记录。
  
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=querytel&p1=1&p2=10&p3=0
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"querytel", "p1":1, "p2":10, "p3":0}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | querysms |字符型|控制命令名称|
|p1 |1 |数值型|从第几条短信开始查询（offset）|
|p2 |10 |数值型|共查询多少条（rows On Page）|
|p3 |10 |数值型|查询的通话类型。（0：所有；1：仅来电；2：仅外呼电话；3：仅漏接来电）|
|p4 |132 |字符型|限制查询的通话号码关键字（省略查所有）|
#### 命令反馈结果
成功时返回：
```json
{
  "subType": 31,
  "code": 0,
  "offset": "1",
  "limit": "3",
  "callType": 0,
  "qkey": "",
  "results": [
    {
      "slot": 1,
      "dir": 1,
      "phNum": "053256894747",
      "telStartTs": 1751421911,
      "telEndTs": 1751421941,
      "conn": 1
    },
    {
      "slot": 2,
      "dir": 0,
      "phNum": "13855668899",
      "telStartTs": 1751267248,
      "telEndTs": 1751267251,
      "conn": 0
    },
    {
      "slot": 2,
      "dir": 1,
      "phNum": "8613316582441",
      "telStartTs": 1751266780,
      "telEndTs": 1751266787,
      "conn": 0
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "anonymous",
      "telStartTs": 1751017174,
      "telEndTs": 1751017202,
      "conn": 0
    }
  ],
  "devId": "e51e9881265a3c8",
  "type": 402,
  "netCh": 0,
  "msgTs": 1751461200
}
```

失败时返回：
```json
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
1）查询的通话记录，保存在results字段（集合）中。
  
2）p1参数指定从通话记录库的第几条开始查询（最值是1）， p2参数指定共查询多少条。
比如：当您需要分页查询，每页5条通话记录。查询第1页时，需要发送参数：
  <center>```p1=1(从第1条开始查询)；p2=5(共查询5条) ```</center>
查询第2页时，需要发送参数：
    <center>```p1=6(从第1条开始查询)；p2=5(共查询5条) ```</center>
依次类推。
  
3）当results字段中返回的记录数大于p2指定的查询条数时，表示后面还有更多记录可以查询。
比如：指定参数：p1=1, p2=5。返回的查询结果中results的记录数是6，表示本页查询完成后，后面还有更多的通话记录，可以继续查询。
同样的，如果指定参数：p1=1, p2=5。返回的查询结果中results的记录数是5 或 小于5。则表示本页面已经是最后一页了。后面没有更多通话记录了。
  
4）本地通话记录库是按通话时间“降序保存”的，即最后进行的通话，总是出现在通话记录库的第1页的第1条。如果您需要查询通话记录库中最近的5条记录，则指定的参数总是：
  <center>```p1=1(从第1条开始查询)；p2=5(共查询5条) ```</center>
这样的话，querytel命令总是返回开发板最近记录的5条通话记录。
  
5）返回记录的结果的各字段意义解释：
```json
  "results": [
    {
      "slot": 1,	//卡槽号。1表示卡槽一
      "dir": 1,		//通话方向。 0表示呼入通话；1表示呼出通话
      "phNum": "053256894747",		//通话号码
      "telStartTs": 1751421911,		//通话开始时间戳
      "telEndTs": 1751421941,		//通话结束时间戳
      "conn": 1		//电话是否接通。0：未接通；1：已接通
    }]
```








### 3.6 OTA Updates

#### dailyota - 设置每日OTA升级时间
### “命令:dailyOTA - 设置每日自动OTA升级的时间”使用说明
#### 命令的作用
使用 dailyOTA 命令，可以让开发板在每天的固定时段，自动完成一次OTA升级。
默认值是3，表示每天3点自动重启。参数中只能指定小时，分钟随机。
如果开发板发现了新的固件版本，则会自动完成升级。升级成功后，开发板自动重启。
如果开发板未发现新的固件版本，则不执行任何操作。
#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=dailyota&p1=3
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"dailyota", "p1":3, "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | dailyota |字符型|控制命令名称|
|p1 |3 |数值型|开发板每天自动OTA升级的时间。0~23表示时段。取值大于23（如25）则表示关闭每日升级|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无







#### otanow- 立即执行OTA升级
### “命令:otanow - 立即执行OTA升级”使用说明
#### 命令的作用
使用 otanow 命令，可以让设备执行一次在线自动升级。
使用时注意以下事项：
(1) 发出 otanow 命令后，开发板在**90秒内不能断电**，否则会导致升级失败，无法开机。
(2) 开发板升级完成后，会自动重启。您可以登录开发板后台的首页面，查看当前固件版本号。
(3) 开发板已经连入的WIFI热点，必须能正常访问互联网。

#### 命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=otanow
```
#### 命令的格式（TCP方式示例）
```
{"cmd":"otanow", "tid":"1234"}\x11\x12
```
#### 命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | otanow |字符型|控制命令名称|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
#### 命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

#### 命令反馈结果说明
无






## 4. Push Messages (Callback)

### 4.1 Concept

#### 什么是推送消息
### 什么是推送消息？
开发板在完成特定的动作（比如收到了短信、成功连入了WIFI等）之后，主动向您的接口推送的数据，称为：“**推送消息**”。
  
推送消息支持**HTTP GET、POST** 或 **TCP自有协议** 两种推送方式。如果您选择了HTTP推送，在最终产品发行时，推荐使用HTTP POST方式。
  
基于HTTP的推送消息支持**FORM、JSON**两种数据格式；基于TCP的推送消息，仅支持**JSON**一种数据格式，您可以根据需要自行选择。
  
```seq
开发板-您的接口:->     推送消息     ->
```

### 基于HTTP推送消息的示例  
以**消息:100 - WIFI已联网**为例，进行分析说明：
  
#### （1）以 “HTTP GET + FORM格式” 的推送示例：

此种配置下，开发板向您的接口推送数据时，开发板底层实际上是模拟了HTTP URL的GET访问，将需要推送的数据，以参数的形式，放在了您的接口地址后面，例如：  
```
http://www.yoursinf.com/sms?devId=498060912345&type=100&ip=192.168.7.170&ssid=mywifi&dbm=63
```
其中，`http://www.yoursinf.com/sms`是您自己定义的接口地址。
  
而`?devId=498060912345&type=100&ip=192.168.7.170&ssid=mywifi&dbm=63`是由开发板自动附加的参数信息。

在多数的高级语言中，通过读取request对象可以获取到url中的参数信息。比如，在JAVA语言中，如需获取request中的开发板硬件序号，可以通过：`request.getParameter("devId");`获取到对应的信息。
‐
‐
#### （2）以  “HTTP GET + JSON格式” 的推送示例：
此种配置下，开发板向您的接口推送数据时，开发板的底层实际上是模拟了HTTP URL的GET访问，将需要推送的数据打包成了JSON格式，放在了名称为“**p**”的参数中，例如：
```
http://www.yoursinf.com/sms?p={"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":61}
```
其中，`http://www.yoursinf.com/sms`是您自己定义的接口地址。
  
而`?p={"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":61}`是由开发板自动附加的JSON格式的参数信息。

注意，此时开发板推送的JSON数据，被放在了固定的参数名称 **“p”** 中。

在多数的高级语言中，通过读取request对象可以获取到url中的参数信息。比如，在JAVA语言中，如需获取JSON数据，可以通过：`request.getParameter("p");`获取到对应的JSON信息。

    
**HTTP GET方式请注意：由于某些特殊字符（+、&、?等）是不能直接在URL中传递的，开发析参传递前，会对参数内容进行Url Encode，对应的，您的接口收到数据后，需要对数据进行反向的Url Decode。**
‐
‐
#### （3）以  “HTTP POST + FORM格式” 的推送示例：
此种配置下，开发板向您的接口推送数据时，开发板的底层实际上是模拟了HTTP FORM表单的POST提交，例如：
```
  <form action="http://www.yoursinf.com/sms" method="post">
		<input name="devId" value="498060912345">
		<input name="type" value="100">
		<input name="ip" value="192.168.7.170">
		<input name="ssid" value="mywifi">
		<input name="dbm" value="61">
  </form>
```
  
在多数的高级语言中，通过读取request对象可以获取到表单参数信息。比如，在JAVA语言中，如需获取form表单中的开发板硬件序号，可以通过：`request.getParameter("devId");`获取到对应的信息。
‐
‐

#### （4）以  “HTTP POST + JSON格式” 的推送示例：
此种配置下，开发板向您的接口推送数据时，开发板的底层实际上是模拟了HTTP二进制流的POST数据提交，例如：
```
Host:www.yoursinf.com
Content-Length:85
Content-Type:application/json;charset=UTF-8
{
	  "devId": "498060912345",
	  "type": 100,
	  "ip": "192.168.7.170",
	  "ssid": "mywifi",
	  "dbm": 60
}
```
 
在多数的高级语言中，通过读取request中的“二进制流”，可以直接读取到JSON数据。比如在JAVA语言中，可以参考以下方式：
  
```
BufferedReader r = null;
  try {
	r = new BufferedReader(new InputStreamReader(request.getInputStream(), "UTF-8"));
	StringBuilder sb = new StringBuilder();
	String s;
	while ((s = r.readLine()) != null) {
		sb.append(s);
	}
	System.out.println("json params:" + sb.toString());
} catch (Exception e) {
	e.printStackTrace();
} finally {
	if (r != null) r.close();
}
```

### 基于HTTP的几种数据推送方式的总结
选用HTTP GET方式接收数据时，接口一侧的开发相对简单，便于快速开发调试。但选用HTTP GET方式的缺点主要有以下两点：
  1. GET方式传递复杂数据时（比如开发板向您的接口传递“新短信”消息时），接口一侧必须对接收到的数据进行URL Decode操作。
  2. GET方式所能传递的数据长度有限。超长的数据采用HTTP GET传递时，会出现**推送失败**的情况。比如，开发板向接口推送一条包括了较多字数的新短信消息等。
  
基于上述原因，原则了HTTP GET一般只推荐于开发调试阶段使用，最终产品中都推荐使用HTTP POST方式。


### 基于TCP的推送消息示例：
以**消息:100 - WIFI已联网**为例，进行示例说明：
<center>`{"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":76}\x11\x12`</center>
基于TCP的推送消息格式与基于HTTP JSON的格式是完全一样的。唯一不同的是，基于TCP的每一条推送消息的最后以 0x11 0x12 两个ascii字符为固定的结束符。也就是说您的TCP Server收到0x11 0x12固定结束符时，表示一条推送消息已经发送完成。





#### 消息推送的顺序
### 推送消息的时序说明

#### （1）推送消息：100
这是开发板通电开机，在成功连入了WIFI热点后，向您的接口推送的第一个消息，表示开发板已经联网成功。
**接口返回**：接口收到100消息后，可以向接口反馈14位纯文字时间，给开发板设置时钟**（可选）**。
```plantuml
@startuml
开发板 -> 用户接口:       消息：100（WIFI已连网）
用户接口 --> 开发板 :   返回当前时间(14位格式：yyyyMMddHHmmss)  
@enduml
```
14位时间格式为：年年年年月月日日时时分分秒秒，比如：20220218150605。

#### 请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送100消息时，您的HTTP接口Response可以不返回数据（此时开发板时间将是1970年1月1日）。但是，接口的WEB服务器返回的HTTP CODE值，必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送100消息，直到HTTP CODE能够正确返回200。

- 如果您的接口是TCP方式，开发板向您的接口推送100消息时，您的接口 **必须** 返回以下格式的应答：
```
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，您的接口必须返回14位的当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```
{"code":0, "type":999, "netCh":0, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。


#### （2）推送消息：301
开发板开机并成功连入WIFI后，首先对开发板所搭载的通讯模组进行识别。
如果搭载的通讯模组识别未成功（比如开发板上未接入通讯模组，或通讯模组规格不能识别等），开发板会向接口推送301消息。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:  消息：301（设备卡槽模组异常）
@enduml
```


#### （3）推送消息：209
开发板对板载的通讯模组识别完成后，会对卡槽中的SIM卡进行识别。
如果SIM卡识别未成功（比如SIM卡损坏、SIM卡未插好等），开发板会向接口推送209消息。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:  消息：209（SIM卡错误）
@enduml
```

#### （4）推送消息：202、203、204
开发板对卡槽中的SIM卡识别成功后，会对SIM卡进行一系列的初始化处理。
SIM的初始化过程中，开发板会根据初始化的进度，逐一向您的接口推送多个消息，对当前进度进行报告。
当所有初始化处理完成后，最终会推送204消息，表示SIM已经就绪。此时，SIM已经可以的正常接打电话、收发短信。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:  消息：202（SIM卡准备初始化）
开发板 -> 用户接口:  消息：203（SIM卡ICCID上报）
开发板 -> 用户接口:  消息：204（SIM卡已就绪）
@enduml
```



#### （5）推送消息：501、502、603、998、999
当SIM已就绪之后，开发板在正常运行的过程中，如开发板收到新短信等事件时，会主动向您的接口推送消息。
- 501消息表示开发板收到了新短信。
- 502消息表示开发板外发短信成功。
- 603消息表示开发板收到新来电。
- 998消息表示开发板主动推送的周期PING消息，报告网络链接正常。
- 999消息表示开发板对执行**控制消息**的结果反馈。
**接口返回**：无

```plantuml
@startuml
开发板 -> 用户接口:  消息：501、503、603、998、999  
@enduml
```


#### （6）推送消息：205
当SIM已就绪之后，开发板在正常运行的过程中，用户主动取出了卡槽中的SIM卡时，开发板向接口报告205消息。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:  消息：205（SIM卡已被取出）
@enduml
```

#### （7）开发中的注意事项
您的接口并不需要对每一种消息，都进行接收。实际上，您只需要接收您关心的消息就可以了。您的接口处理的消息**越少越好**。举例：如果您只关心接收短信的话，您只需要接收501一种消息就可以了。



### 4.2 Device Status

#### 100 - WIFI已联网
### “消息：100 - WIFI已联网” 使用说明

#### 消息的作用
100消息，是开发板向接口推送的第1个消息。表示开发板已经正确连入了WIFI网络。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |100|数值型|消息ID|
|hwVer |107|字符型|开发板版本号|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|msgTs  | 1750044391 |数值型| 当前消息的时间戳|
|ssid |mywifi |字符型|开发板连入的WIFI名|
|charset |mywifi |字符型（*注1）|WIFI名的编码方式|
|ip  | 192.168.7.170 |字符型|开发板当前IP地址|
|dbm | utf8  |数值型|ssid的信号强度（越高越好）|

**注1**：ssid字段的默认编码，目前是固定值：utf8

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="100">
	<input name="hwVer" value="X31v107">
	<input name="netCh" value="0">
	<input name="msgTs" value="1750044391">
	<input name="ssid" value="mywifi">
	<input name="charset" value="utf8">
	<input name="ip" value="192.168.7.170">
	<input name="dbm" value="61">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
{
  "devId": "498060912345",
  "type": 100,
  "hwVer": "X31v107",
  "netCh": 0,
  "msgTs": 1750044391,
  "ssid": "mywifi",
  "charset": "utf8",
  "ip": "192.168.7.170",
  "dbm": 61
} 
```

 ####请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送100消息时，您的HTTP接口可以不返回数据。但是，接口的WEB服务器返回HTTP CODE值必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送100消息，直到HTTP CODE能够返回200。
- 如果您的接口是TCP方式，开发板向您的接口推送100消息时，您的接口 **必须** 返回以下格式的应答：
```json
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，返回14位当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```json
{"code":0, "type":999, "netCh":0, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。

- 如果您的开发板连入的WIFI热点可以正常访问Internet，您的TCP接口在接收到100消息时也可以不返回具体的时间戳，而是让开发板自身通过全球公共NTP服务自主校准时间。这种情况下，您的接口收到开发板上报的100消息时，可以按以下格式进行应答：
```json
{"cmd":"now", "p2":15, "p3":8}
```
此处，P2=15 表示允许开发板自身通过各种可能的途径进行时间校准；p3=8表示校准后的时区是+8（北京时间）。




#### 101 - SIM1已联网
### “消息：101 - SIM1已联网” 使用说明

#### 消息的作用
101消息，是开发板向接口推送的第1个消息。表示开发板中的SIM1（卡槽1）已经正确连入了网络。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |101|数值型|消息ID|
|netCh  | 1 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|msgTs |1750044391|数值型|当前消息的推送时间戳|
|slot |1 |数值型|开发板的卡槽1|
|dbm | 61  |数值型|SIM卡1的信号强度|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|


#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="101">
	<input name="netCh" value="1">
	<input name="msgTs" value="1750044391">
	<input name="slot" value="1">
	<input name="dbm" value="61">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
{
  "devId": "498060912345",
  "type": 101,
  "netCh": 1,
  "msgTs": 1750044391,
  "slot": 1,
  "dbm": 61,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822"
} 
```

 ####请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送101消息时，您的HTTP接口可以不返回数据。但是，接口的WEB服务器返回HTTP CODE值必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送101消息，直到HTTP CODE能够返回200。
- 如果您的接口是TCP方式，开发板向您的接口推送101消息时，您的接口 **必须** 返回以下格式的应答：
```
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，返回14位当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```
{"code":0, "type":999, "netCh":1, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。

- 如果您的开发板连入的WIFI热点可以正常访问Internet，您的TCP接口在接收到101消息时也可以不返回具体的时间戳，而是让开发板自身通过全球公共NTP服务自主校准时间。这种情况下，您的接口收到开发板上报的101消息时，可以按以下格式进行应答：
```json
{"cmd":"now", "p2":15, "p3":8}
```
此处，P2=15 表示允许开发板自身通过各种可能的途径进行时间校准；p3=8表示校准后的时区是+8（北京时间）。


#### 102 - SIM2已联网
### “消息：102 - SIM2已联网” 使用说明

#### 消息的作用
102消息，是开发板向接口推送的第1个消息。表示开发板中的SIM2（卡槽2）已经正确连入了网络。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |101|数值型|消息ID|
|netCh  | 2 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|msgTs |1750044391|数值型|当前消息的推送时间戳|
|slot |2 |数值型|开发板的卡槽1|
|dbm | 61  |数值型|SIM卡1的信号强度|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|


#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="102">
	<input name="netCh" value="2">
	<input name="msgTs" value="1750044391">
	<input name="slot" value="2">
	<input name="dbm" value="61">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
{
  "devId": "498060912345",
  "type": 102,
  "netCh": 2,
  "msgTs": 1750044391,
  "slot": 2,
  "dbm": 61,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822"
} 
```

 ####请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送102消息时，您的HTTP接口可以不返回数据。但是，接口的WEB服务器返回HTTP CODE值必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送102消息，直到HTTP CODE能够返回200。
- 如果您的接口是TCP方式，开发板向您的接口推送101消息时，您的接口 **必须** 返回以下格式的应答：
```
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，返回14位当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```
{"code":0, "type":999, "netCh":2, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。

- 如果您的开发板连入的WIFI热点可以正常访问Internet，您的TCP接口在接收到102消息时也可以不返回具体的时间戳，而是让开发板自身通过全球公共NTP服务自主校准时间。这种情况下，您的接口收到开发板上报的102消息时，可以按以下格式进行应答：
```json
{"cmd":"now", "p2":15, "p3":8}
```
此处，P2=15 表示允许开发板自身通过各种可能的途径进行时间校准；p3=8表示校准后的时区是+8（北京时间）。



#### 202 - SIM卡基站注册
### “消息：202 - SIM卡准备基站注册” 使用说明

#### 消息的作用
开发板上对应的卡槽正确的插入了SIM时，开发板会尝试对SIM卡进行初始化，并在初始化处理开始时，先向您的接口推送本消息。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |202|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="202">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 202,
  "slot": 1,
  "netCh": 0
} 

 ```




#### 203 - SIM卡IMSI上报
### “消息：203 - SIM卡IMSI上报” 使用说明

#### 消息的作用
开发板对SIM卡进行初始化的过程中，会尝试读取SIM卡的IMSI。如果IMSI取读成功，则通过203消息向您的接口推送。

**说明**：
- 每一张SIM卡，都有一个全球唯一的IMSI，补换卡后IMSI也不会变化。SIM卡的IMSI可以理解为是手机号的另一种表示形式。您可以通过IMSI来唯一标识一张SIM卡。

- 每一张SIMI卡，都有一个全球唯的ICCID，但补换卡后ICCID会变化。ICCID通常也会印刷在SIM卡的背面。

－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |203|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|dbm | 61  |数值型|当前SIM卡的信号强度。-1表示尚未取得信号强度数据|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="203">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="dbm" value="61">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 203,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "dbm": 61,
  "netCh": 0
} 
 ```







#### 204 - SIM卡已就绪
### “消息：204 - SIM卡已就绪” 使用说明

#### 消息的作用
开发板完成了SIM卡的全部初始化处理之后，会向您的接口推送204消息。此消息表示SIM卡已经处于正常待机状态，此时SIM卡已经可以正常的进行收发短信、接打电话等操作。

一般情况下，可以忽略203消息，只读取204消息即可。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |204|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|dbm | 61  |数值型|当前SIM卡的信号强度。-1表示尚未取得信号强度数据|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="204">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="dbm" value="61">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 204,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "dbm": 61,
  "netCh": 0
} 
 ```







#### 205 - SIM卡已弹出
### “消息：205 - SIM卡已被弹出” 使用说明

#### 消息的作用
当SIM卡进入了就绪状态之后，如果用户主动取出了SIM卡，此时开发板会向您的接口推送205消息。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |205|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="205">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 205,
  "slot": 1,
  "netCh": 0
} 

 ```





#### 209 - SIM卡错误
### “消息：209 - SIM卡错误” 使用说明

#### 消息的作用
当SIM卡在初始化过程中发现了异常，开发板会向您的接口推送209消息。通常，产生209消息一般有以下几种原因：
- SIM卡 已损坏 或 未插好
- SIM卡欠费停机
- SIM卡有PUK开机密码
- 在4G单频全网通通讯模组中，插入了2G单频SIM卡（如长城移动、五三互联等虚商的SIM卡。此种卡的特点是不能上网，这类卡都通常是2G单频卡。针对这类卡，通常建议搭配2G通讯模组使用）。

#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |209|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="209">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 209,
  "slot": 1,
  "netCh": 0
} 

 ```






#### 301 - 通信模组异常
### “消息：301 - 通信模组异常” 使用说明

#### 消息的作用
当开发板在尝试侦测板载的通信模组时失败，开发板会向您的接口推送301消息。通常，产生301消息，一般有以下几种原因：
- 板载的通信模组已损坏
- 板载的通信模组尚未被支持
-

#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |301|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="301">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 301,
  "slot": 1,
  "netCh": 0
} 

 ```







### 4.3 SMS Messages

#### 501 - 新短信消息
### “消息：501 - 新短信报告消息” 使用说明

#### 消息的作用
当SIM卡已经完成初始化，处于就绪状态之后，如果SIM卡收到了新短信，则开发板会向您的接口推送501消息。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |501|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|短信号码|
|smsBd | 您的话费余额是100元。【中国移动】  |字符型|短信内容|
|charset | utf8  |字符型|phNum、smsBd字段的编码方式。**（*注1）**|
|smsTm | 1647344840456  |timestamp|短信时间戳（13位，精确到毫秒）|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
**注1：**phNum、smsBd两个字段目前的编码方式是：utf8。charset字段目前也是固定值：utf8。

-
#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="501">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="smsBd" value="您的话费余额是100元。【中国移动】">
	<input name="charset" value="utf8">
	<input name="smsTm" value="1647344840456">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 501,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "smsBd": "您的话费余额是100元。【中国移动】",
  "charset":"utf8",
  "smsTm": 1647344840456,
  "netCh": 0
} 
```

#### 补充说明
如果您使用的是TCP接口时，使用**网络调试助手**工具进行调试时，建议将工具设置为UTF8模式，否则开发板上报的中文短信会显示为乱码字符。
设置方法为：点击**网络调试助手**右侧的**数据日志**文本框，点击鼠标右键，在弹出的菜单中设置即可。
<center>![](http://www.lvyatech.com/img/lu/netass2.png)</center>








#### 502 - 外发短信成功消息
### “消息：502 - 外发短信成功消息” 使用说明

#### 消息的作用
当开发板接收到您的**sendsms控制指令**后，会根据您的指令，控制SIM卡向外发送短信。如果SIM卡成功发送了短信，则会向您的接口推送502消息。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |502|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|tid | 1647344840  |字符型|sendsms控制消息中给出的tid，此处原样回送|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
 **对tid参数的进一步说明：** tid参数是在**控制指令**中，由您的接口主动提供的一个参数，这个参数可以是任意的值。这个参数的目的是，用于对应您之前的发出的**控制指令**。比如，您之前控制指令是：
```
http://192.168.7.170/ctrl?cmd=sendsms&tid=1647344840&slot=2&p1=10001&p2=查话费
```
（注意：为了便于理解，上述是简化了的控制指令。关于指令的细节以控制指令一节的文档为准。）

根据上述**控制指令**，开发板会控制卡槽2中的SIM卡，给号码为10001发短信，内容为：查话费。
当本条短信外发成功之后，开发板会向接口推送502指令。在502指令中，会将tid=1647344840的参数内容**原样送回**，用于通知您的接口，具体是哪一条短信，外发已经完成了。

由于外发短信是“异步”操作，如果您同时向开发板发送了多条“**sendsms控制指令**”时，接口获得的502消息无法保证前后顺序的一致性。所以，您需要为每一条“**sendsms控制指令**”都赋予一个唯一的tid参数，用于区分具体是哪一条外发短信已经成功完成了。
 －
#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="502">
	<input name="slot" value="1">
	<input name="tid" value="1647344840">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 502,
  "slot": 1,
  "tid": "1647344840",
  "netCh": 0
} 

 ```











### 4.4 Call Messages

#### 601 - 来电振铃消息
### “消息：601 - 来电振铃消息” 使用说明

#### 消息的作用
当SIM卡已经完成初始化，并处于就绪状态之后，此时如果SIM卡收到了来电，开发板会向您的接口推送601来电振铃消息。
我们以手机接到来电为例：601消息相当于，您的手机收到了来电，此时，您即没有接听，也没有挂断，手机正在响铃的状态。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |601|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="601">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 601,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```




#### 602 - 来电接通消息
### “消息：602 - 来电接通消息” 使用说明

#### 消息的作用
当开发板上的SIM卡收到了来电，此时可以通过控制指令“telanswer”遥控开发板的SIM卡接听来电。来电接通之后，开发板会向您的接口推送602来电接通消息。
我们以手机接到来电为例：602消息相当于，您的手机收到了来电，您点击了接听按键，通话处于被接通了的状态。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |602|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="603">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 603,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```




#### 603 - 来电挂断消息
### “消息：603 - 来电挂断消息” 使用说明

#### 消息的作用
开发板正在处于通话状态中，此时如果对方挂机，或者是向开发板发送telhangup控制指令主动挂机之后，开发板会向您的接口推送603来电挂断消息。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |603|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|endTm | 1647344840  |timestamp|来电结束时间戳。|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="603">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="endTm" value="1647344840">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 603,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "endTm": 1647344840,
  "netCh": 0
} 

 ```











#### 620 - 去电拨号消息
### “消息：620 - 去电拨号消息” 使用说明

#### 消息的作用
当SIM卡已经完成初始化，并处于就绪状态之后，此时您通过控制指令“teledial”遥控开发板的某个卡槽，向指定号码拨打电话时，开发板会首先检测电话卡是否有正常的拨号音，如果检测到拨号音，开发板会自动进行电话拨号，拨号成功后向您的接口推送620去电拨号消息。
我们以手机向外拨打电话为例：您在手机上输入了拨打的电话号码，并点击了“拨号按键”，电话执行拨号动作，并确认拨号成功之后，您的接口就会收到620消息。
－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |620|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="620">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 620,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```





#### 621 - 去电振铃消息
### “消息：621 - 去电振铃消息” 使用说明

#### 消息的作用
您通过控制指令“teledial”向指定号码拨打电话时，开发板会首先进行电话拨号，拨号成功后，对方电话会响铃，提醒对方接听。对方电话正在响铃中的时刻，开发板会向您的接口推送621去电振铃消息。
我们以手机向外拨打电话为例：您在手机上拨打对方电话之后，对方电话一旦开始响铃，您的接口就会收到621消息。
－
#### 消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |621|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="621">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 621,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```



#### 622 - 去电接通报告
### “消息：622 - 去电接通消息” 使用说明

#### 消息的作用
您通过控制指令“teledial”向指定号码拨打电话时，开发板会自动呼叫对方号码，对方接听后，开发板会向您的接口推送622去电接通消息。
我们以手机向外拨打电话为例：您在手机上拨打对方电话，对方接听后（此时电话已接通），您的接口就会收到622消息。
－
#### 消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |622|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="622">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 622,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```




#### 623 - 去电挂断报告
### “消息：623 - 去电挂断消息” 使用说明

#### 消息的作用
您通过控制指令“teledial”向指定号码拨打电话时，开发板会自动呼叫对方号码，双方的通话结束后（对方挂机，或者向开发板发送telhangup控制指令，主动挂机），开发板会向您的接口推送623去电挂断消息。
我们以手机向外拨打电话为例：您在手机上拨打对方电话，电话接通后开始通话，当通话结束时（任意一端挂断电话），您的接口就会收到623消息。
－
#### 消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |623|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="623">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 623,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```





#### 641 - 通话本地按键
### “消息：641 - 通话本地按键消息” 使用说明

#### 消息的作用
开发板与对方进入到通话中的状态之后，向开发板发送“按键命令”，相当于自己的电话上按下了某个按键，开发板会向您的接口推送641通话按键消息。
我们拨打联通10010号码为例：当您拨通10010号码时，首先会听到自动语音提示，类似于：
> 您好，感谢致电中国联通，按1查询话费余额， 按2查询流量余额， 按3进入……等等的提示音。

在开发板的通话中，此时您在电话上按下“1”，则开发板会向您的接口上报641消息。
注意：如果您在电话上按下了一串按键，比如连续按下了“123#”，此时，开发板会向您的接口顺序上报四个641的通话按键消息，分别是： 按键1；按键2；按键3；按键#
－
#### 消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |641|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|reason| 1 | 字符型 | 通话按键，一般包括：0-9 *# 等
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="623">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="reason" value="1">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 623,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "reason": "1",
  "netCh": 0
} 

 ```






#### 642 - 通话远程按键
### “消息：642 - 通话远程按键消息” 使用说明

#### 消息的作用
开发板与对方进入到通话中的状态之后，如果对方在自己的电话上按下了某个按键，开发板会向您的接口推送642通话按键消息。
比如需要实现类似于电话外卖订餐的业务场景，在与客户的通话过程中，通过TTS语音提示客户：
> 您好，请输入您购买套餐的数字编号，按#号键结束

此时客户在电话上按下“1#”，则开发板会向您的接口上报642消息。
注意：如果您在电话上按下了一串按键，比如连续按下了“12#”，此时，开发板会向您的接口顺序上报三个641的通话按键消息，分别是： 按键1；按键2；按键#
－
#### 消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |642|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|reason| 1 | 字符型 | 通话按键，一般包括：0-9 *# 等
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="623">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="reason" value="1">
	<input name="netCh" value="0">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 623,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "reason": "1",
  "netCh": 0
} 

 ```






### 4.5 Other Messages

#### 998 - 设备PING消息
### “消息：998 - 设备PING消息” 使用说明

#### 消息的作用
开发板正确连入WIFI之后，根据用户在WEB管理页面的设置，开发板可以在规定的时间（默认为110秒），循环向您的接口推送998消息。998推送消息一般有两个用途：
1、您的接口可以基于此判断开发板是否处于正常的开机状态。
2、在TCP Server的方式下，维持网络连接，避免因长时间无通信导致TCP连接中断。实际上，在TCP Server的方式下，998消息总是会被定时的推送到您的接口上。

>【提示】:
一般而言，接口端如果需要判断开发板是否“在线”，主要有两种方式：
1）假设开发板每60秒向接口上报一次PING消息，一般来说，接口端如果连续3次（相当于60秒*3+15秒缓冲时间=195秒），都没有按时收到开发板上报的PING消息，就可以判定开发板已经“离线”了。
这种判断方法，以接口端“被动”接收PING消息，来判断开发板是否“在线”。
2）TCP接口模式中，接口也可以“主动”向开发板发送 stat 请求`{"cmd":"stat", "tid":123}`，开发板在收到接口的请求后，会主动上报开发板的状态信息。这样，也可以判断开发板是否“在线”。
当然，也可以将方法（1）、方法（2）组合起来，更有效的判断开发板是否“在线”。

－
#### 消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |998|数值型|消息ID|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|cnt |1|数值型|PING消息中的自增字段，每上报一次数值自动加 1。|

#### 消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="998">
	<input name="netCh" value="0">
	<input name="cnt" value="1">
</form>
```

#### 消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 998,
  "netCh": 0,
  "cnt": 1
} 

 ```





## 5. SMS Control Instructions

### 5.1 Concept

#### 什么是短信指令
### 什么是短信指令？
本质上，**短信指令**是一条由用户主动发送到开发板上的短信，用于通知开发板执行相应的动作。
短信可以发送到开发板中的任意一个卡槽上，只要SIM卡能够正常接收到短信就可以识别，并执行预期动作。
```seq
短信-开发板:->     短信指令     ->
```
短信指令的目的是让用户能够通过短信，对开发板进行一些基本的设置，比如，让开发板连接到附近的WIFI热点、获取开发板当前的IP地址、获取开发板基本状态信息、控制开发板重启等。
  
与**控制指令**不同的是，短信指令只需要验证最基础的**用户密码**，不需要管理token。

### 控制指令的示例
以通知**开发板增加WIFI热点信息(addwifi)**的短信指令为例，说明短信指令的构成：
  ```
  *#addwifi#000000#mywifi#12345678
  ```
   `*#addwifi#`这是短信指令的固定开头，表示此短信用于通知开发板，附近可以连入的WIFI热点信息。
   `000000`是所有短信指令的所必须的一个参数，用于验证用户密码。
   `#mywifi#12345678`用于指明开发板附近可以连入的WIFI热点名称、密码。
   
   这条**短信指令**的作用是，给开发板增加一个可以连入的WIFI热点信息，此时如果开发板还没有连接任何WIFI，则短信发出后，开发板会自动尝试连接短信中提供的WIFI热点。
   
### 什么是管理员短信指令？
“管理员短信指令”是一组保留给管理员使用的特殊短信指令，通过“管理员短信指令”无需通过登录开发板的后台WEB页面，而是以短信的方式，直接操纵开发板的底层设置。“管理员短信指令”的主要特点是：
1、短信以pm99开头；
2、短信不需要验证“用户密码”，而是直接验证管理员密码的token。





### 5.2 User Commands

#### pwd - 修改用户密码
### “短信指令:pwd - 修改用户密码”使用说明
#### 指令的作用
给开发板中的任意一张SIM卡发送 *#pwd# 指令，可以修改用户密码。
#### 指令的格式（示例）
```
*#pwd#000000#123456
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pwd#   |短信指令名称|
|000000 |旧用户密码（不能少于4个字符）|
|123456 |变更后的新用户密码（不能少于4个字符）|

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的用户密码已经变更成功。
```

失败时开发板回复短信：
```
设备 498060912345 的用户密码变更失败！
```

#### 指令反馈结果说明
无






#### stat - 查询开发板当前状态
### “短信指令:stat - 查询开发板当前状态”使用说明
#### 指令的作用
给开发板中的任意一张SIM卡发送 *#stat# 指令，可以查询开发板的当前状态。
#### 指令的格式（示例）
```
*#stat#000000
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#stat#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|

#### 指令反馈结果
成功时开发板回复短信：
```
Y5-416
卡槽：移动96%；移动63%
联网：WIFI
498060912345
```

失败时开发板回复短信：
```
用户密码不正确！
```

#### 指令反馈结果说明
无







#### wf - 打开关闭wifi及查询状态
### “短信指令:wf - 打开关闭wifi及查询状态”使用说明
#### 指令的作用
给开发板中的任意一张SIM卡发送 *#wf# 指令，可以查询开发板当前连接WIFI的状态。当开发板始终无法正常连入WIFI时，发送此短信，可以查询未成功连入WIFI的原因。
您也可以通过本短信指令，打开或关闭开发板上的WIFI功能。
  
注意！在HTTP接口模式中，开发板的WIFI功能，必须是要处于开启状态。只有在TCP接口模式中，尝试关闭开发板的WIFI功能后，开发板会尝试通过手机卡网络进行联网通信。
  
#### 指令的格式（示例）
```
*#wf#000000#off
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#wf#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|
|on 或 off   |on:打开开发板的WIFI; off:关闭开发板的WIFI; 不写此参数时，表示查询当前WIFI状态|

#### 指令反馈结果
查询开发板WIFI状态（*#wf#000000）时，开发板成功连入WIFI的回复短信：
```
设备498060912345已经连接至:mywifi,IP:192.168.7.170,信号:56%
```

开发板未能成功连入WIFI的回复短信：
```
用户密码不正确！
或
设备498060912345连接至:mywifi的最后连接状态是：密码错。
```

关闭开发板WIFI时（*#wf#000000#off）的回复短信：
```
设备498060912345的WIFI已经关闭。
```

#### 指令反馈结果说明
无









#### addwf - 增加wifi热点信息
### “短信指令:addwf - 增加wifi热点信息”使用说明
#### 指令的作用
给开发板中的任意一张SIM卡发送 *#addwf# 指令，可以向开发板增加一条可连入的WIFI热点信息。开发板如果最终需要发行给用户使用，通常用户收到后，至少需要发送一条本短信，让开发板连入WIFI。
#### 指令的格式（示例）
```
*#addwf#000000#wifi名#wifi密码
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#addwf#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|
|wifi名 |开发板附近可以连入的WIFI热点名|
|wifi密码 |开发板附近可以连入的WIFI热点密码|

#### 指令反馈结果
成功时开发板回复短信：
```
设备498060912345收到了wifi热点名:xxxx,密码:xxxx
```

失败时开发板回复短信：
```
用户密码不正确！
```

#### 指令反馈结果说明
无







#### restart - 控制开发板重启
### “短信指令:restart - 控制开发板重启”使用说明
#### 指令的作用
给开发板中的任意一张SIM卡发送 *#restart# 指令，可以控制开发板立即重启。
#### 指令的格式（示例）
```
*#restart#000000
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#restart#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|

#### 指令反馈结果
成功时开发板回复短信：
```
设备498060912345接到了您的重启指令。
```

失败时开发板回复短信：
```
用户密码不正确！
```

#### 指令反馈结果说明
无










#### slotnet - 管理卡的流量功能
### “短信指令:slotnet - 开启/关闭卡槽流量联网功能”使用说明
#### 指令的作用
给开发板中的任意一张SIM卡发送 *#slotnet# 指令，可以开启对应卡的流量联网功能。
#### 指令的格式（示例）
```
*#slotnet#000000#on/off
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#slotnet#   |短信指令名称|
|000000 |旧用户密码（不能少于4个字符）|
|on/off |on :开启卡的流量联网功能; off:关闭卡的流量联网功能|

例如:当向设备中的某个卡发送 *#slotnet#000000#on 相当于通知收到此短信的卡开启流量联网功能。如果此时设备没有正常连入WiFi网络，则设备会尝试通过这张卡的流量功能，进行联网。直到WiFi网络恢复后，设备会自动断开卡的流量联网功能，切换回WiFi网络。

短信中也可以进一步指定具体的卡槽。例如，需要设备的卡1进行联网的短信格式如下：
```
*#slot1net#000000#on
```
这条短信发出后，无论发给设备的卡1 或是 卡2，即无论设备的卡1或是卡2收到此短信，都将只开启卡1的流量联网功能。
当设备的卡1不方便接收短信时，可以发送带有指定卡槽的短信，发给设备的卡2，也可以开启设备的卡1流量联网功能。

注意：为了保护您的手机卡资费安全，以上短信发出后，设备仅执行对应的卡联网动作，并不会主动向发短信的手机回复短信。
如果需要设备主动回复短信，进一步确认设备是否收到并执行相应动作，可以在短信最后增加 #回复 参数，格式如下：
```
*#slotnet#000000#on#回复
```

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的流量联网功能已经开启。
```

失败时开发板回复短信：
```
设备 498060912345 的流量联网功能开启失败！
```

#### 指令反馈结果说明
无







### 5.3 Admin Commands

#### pm99inf - 变更接口地址
### “管理员短信指令:pm99inf - 为开发板设置接口地址信息”使用说明
#### 指令的作用
通过短信为开发板设置接口地址。
通过短信设置接口地址，功能上等同与登录开发板后台WEB管理页面，并修改接口地址。对应的WEB界面图示如下：
  <center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=d50cffff12be700872380d1a2a315f30)</center>
### 一、通过短信为开发板设置接口地址
#### 指令的格式（示例）
```html
*#pm99inf#7257d243875d0a5a#http://www.domain.com/inf
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99inf#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|http://www.domain.com/inf |开发板的接口地址|

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的接口URL配置完成!
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

#### 指令反馈结果说明
无


  
### 二、通过短信反向查询开发板中的接口地址
#### 指令的格式（示例）
```html
*#pm99askinf#7257d243875d0a5a
```

  
#### 指令参数说明
| 参数（示例） |说明|
| ------------  |--|
|*#pm99askinf#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|


#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的接口：http://www.domain.com/inf
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

#### 指令反馈结果说明
无






#### pm99msgid - 变更上报消息
### “管理员短信指令:pm99msgid - 为开发板设置上报的接口消息”使用说明
#### 指令的作用
通过短信为开发板设置允许向接口上报的消息ID。
通过短信设置接口消息ID，功能上等同与登录开发板后台WEB管理页面，并修改接口消息设置。对应的WEB界面图示如下：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=aad33637a76e837889c835f66e5f4f79)</center>

#### 指令的格式（示例）
```html
*#pm99msgid#7257d243875d0a5a#100,501,603
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99msgid#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|100,501,603 |开发板允许上报的接口消息ID|

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的接口上报消息设置完成!
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

#### 指令反馈结果说明
无








#### pm99aes - 变更加密设置
### “管理员短信指令:pm99aes - 为开发板设置接口加密设置”使用说明
#### 指令的作用
通过短信为开发板设置接口上报时的加密参数。
通过短信设置接口加密参数，功能上等同与登录开发板后台WEB管理页面，并修改接口的加密参数。对应的WEB界面图示如下：
    <center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=10fada243287f7b175dbe6e1e8c45c75)</center>
#### 指令的格式（示例）
```html
*#pm99aes#7257d243875d0a5a#1#FLfSxDB7WICM1q7#c9NbOH3XtlYsuahX
或
*#pm99aes#7257d243875d0a5a#no   /**关闭开发板接口加密**/
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99aes#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|1 |开发板设置开启AES128加密。如果值为“0”表示关闭开发板的加密设置|
|FLfSxDB7WICM1q7 | 设置AES128的 KEY |
|c9NbOH3XtlYsuahX | 设置AES128的 IV |

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的AES加密设置完成!
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

#### 指令反馈结果说明
无









#### pm99admpwd - 变更管理密码
### “管理员短信指令:pm99admpwd - 修改开发板的管理员密码”使用说明
#### 指令的作用
通过短信修改开发板的管理员密码。
通过短信修改管理员密码，功能上等同与登录开发板后台WEB管理页面，并修改管理员密码。对应的WEB界面图示如下：
  <center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=7bfd7131f9d12c223598ec709928ec6a)</center>
  
#### 指令的格式（示例）
```html
*#pm99admpwd#7257d243875d0a5a#admin#123456
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99admpwd#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|admin |开发板的旧管理员密码|
|123456 | 开发板的新管理员密码|

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 新的管理员密码设置完成!
```

失败时开发板回复短信：
```
格式或密码错误!请与管理员联系.
```

#### 指令反馈结果说明
无










#### pm99usrpwd - 变更用户密码
### “管理员短信指令:pm99usrpwd - 修改开发板的用户密码”使用说明
#### 指令的作用
通过短信修改开发板的用户密码。一般用于远程维护开发板中的用户密码，应对用户反馈密码遗忘等场景。
通过短信修改用户密码，功能上等同与登录开发板后台WEB管理页面，并修改用户密码。对应的WEB界面图示如下：
  <center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=f85e546a70d7e20f9b9959f81518063b)</center>
  
#### 指令的格式（示例）
```html
*#pm99usrpwd#7257d243875d0a5a#000000
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99usrpwd#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|000000 |开发板的用户密码|

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的用户密码设置完成!
```

失败时开发板回复短信：
```
格式或密码错误!请与管理员联系.
```

#### 指令反馈结果说明
无











#### pm99rst - 重启开发板
### “管理员短信指令:pm99rst - 控制开发板重启”使用说明
#### 指令的作用
通过短信重启开发板。
#### 指令的格式（示例）
```html
*#pm99rst#7257d243875d0a5a
```
#### 指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99rst#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|

#### 指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 接到了您的重启指令.
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

#### 指令反馈结果说明
无











## 6. Configuration & Setup

### (2) 开发板连入WIFI
接下来，给开发板连入WiFi热点。（注意：连入的WiFi热点必须是２.４Ｇ制式）
WIFI连入成功后，WIFI指示灯会变成“绿色”并且“常亮不闪”的状态。如下图所示：
  
  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=7a80f11c01e7bd139575b87549b1518c)
  
> WIFI指示灯为“绿色”并且“常亮不闪”，表示WIFI联网成功。

  

  
有三种方法，可以让开发板连入WIFI。
  
###   方法一：利用开发板中默认的WIFI名称与密码，连入WIFI网络。

开发板在出厂时，内置了一组默认的WIFI名称、密码信息，内容是：
<center>  ```名称：Lzwifi```</center>
<center>  ```密码：Lzwifi88```</center>

>登录后台页面时，出厂默认的用户名／密码是：admin / admin


您可以在WIFI路由器上，开启一个同样的WIFI热点（确保WIFI名称、密码与开发板内置的信息完全一致）。
  这样，开发板就可以直接连入到您的WIFI网络了。
> 注意！开启的WIFI热点，必须是2.4G热点。


###   方法二：通过短信，将您的WIFI热点信息，发送给开发板。

首先，确保开发板中的手机卡，已经处于正常待机状态（卡槽两侧的指示灯是“常亮不闪”的状态）。
  
  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=6f371b97f4b83fa0a66e0444897887e5)
  
  > 卡槽两侧的指示灯是“常亮不闪”的状态，表示手机卡已处于正常待机状态。
  
将您的WIFI热点信息（名称、密码）编辑到短信中，然后用自己的手机，发送短信到开发板中的任意一张手机卡上：

<center>`*#addwf#000000#热点名#热点密码`</center>

#### 短信指令格式说明：
- `*#addwf#`：短信指令的固定开头。表示让开发板接收一个新的WiFi热点信息。
- `000000`：  开发板的**用户密码**，出厂默认是000000。（如果您自行修改过，需要替换成您自己的密码）
- `热点名`：开发板附近可以连入的WiFi名。
- `密码`： 开发板附近可以连入的WiFi密码。

#### 示例：
比如，在开发板附近可以连入的WiFi热点，名称是：**myhome**，热点密码是：12345678。
您可以编辑以下格式的短信:
  
<center>`*#addwf#000000#myhome#12345678`</center>

您在自己的手机上编辑好上述内容的短信，发送到开发板的任意一张手机卡上即可。
  
开发板在收到您的短信之后，**WIFI指示灯**开始进入闪烁状态，表示正在尝试连入您提供的WIFI热点。
  
当开发板正确连入了WIFI热点之后，开发板上的**WIFI指标灯**将变为**常亮不闪**的状态，表示WIFI热点连入成功。
  
  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=7a80f11c01e7bd139575b87549b1518c)

> WIFI指示灯为“绿色”并且“常亮不闪”，表示WIFI联网成功。
  


###   方法三：通过开发板自带的AP热点，进行配置。

开发板初次通电开机之后，板载的WIFI会处于AP模式，此时开发板相当于一个小型无线路由器，您的手机或电脑，可以直接连入到开发板的默认热点上，这样，您的手机或电脑的WIFI成功连入到开发板之后，就可以访问到开发板后台管理界面了。
  
开发板刚开机时，板载WIFI会自动切入到AP模式，此时开发板的WIFI指示灯会亮“黄灯”，表示板载WIFI已经就绪，等待您的手机或电脑连入。
  
  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=656ca5d5690a97c5003850f89d32edd4)

此时，您可以在手机或电脑上，搜索附近的WIFI热点时，看到开发板的热点信息：
  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=680152d5a3752b5e6a2539b19e728dfa)
  
您通过手机或电脑，连入到这个热点之后，打开浏览器访问以下地址，即可登录开发板后台：
  
（1）访问开发板管理后台的地址：```http://192.168.4.1/mgr```
（2）访问开发板WIFI管理器的地址：```http://192.168.4.1/ap```
	  
以下是访问开发板的WIFI管理器后台 http://192.168.4.1/ap 的页面：
  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=8fc245f7b7b1ba410dc29a068fb8ed7a)
  
在WIFI管理器后台中，您可以点击“搜索附近的WIFI热点”按钮，搜索开发板附近的WIFI热点，并点击“添加”按钮，将开发板加入到您的WIFI热点。
也可以点击“手动添加热点信息”按钮，直接输入附近的WIFI名称、密码信息。


### (3) 获取开发板的ＩＰ地址
开发板正确连入了您指定的WiFi热点之后，您需要获取开发板的IP地址，以便于登录开发板的WEB管理端，完成进一步的用户接口信息的配置。

有多种方法，可以获取到开发板的IP地址：
-   1. 通过**短信指令**获取开发板IP地址（推荐）。
-   2. 通过UDP工具获取开发板的IP地址。
-   3. 通过WIFI路由器的后台登录界面获取IP地址。
-   4. 通过开发板显示屏查看IP地址。（推荐）

  
  ###1. 通过短信指令获取IP地址
通过**短信指令**获取IP地址的方法是官方推荐的一种方式。编辑以下格式的**短信指令**：
  <center>`*#askwf#000000`</center>
  
#### 短信指令格式说明
- `*#askwf#`：短信指令的固定标识。
- `000000`：默认的用户密码。

编辑上述短信发送到开发板中的任意一张手机卡上，开发板将自动向您的手机回复一条包括当前IP地址的短信。
```
设备(498060912345)已连至mywifi,IP:192.168.7.170,信号:70%
```
.
### 2. 通过UDP工具获取开发板的IP地址
您可以使用任意一款UDP Server工具，监听38585的UDP端口，即可以获取到开发板的IP地址。我们推荐您使用**网络调试助手**这个工具。此工具的下载地址是：http://www.cmsoft.cn/resource/102.html
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=bbd8fd15d3ac7f84b368e8d88dfa6c1f)</center>

.
使用时，注意软件左上角的设置区域中的以下内容：
-   协议类型选：UDP
-   本地主机地址必须与开发板在同一个网段内
-   本地主机端口填写：38585
最后点击“开启”按钮，就可以了。

将开发板断电重启，开发板自动连接到您指定的WIFI网络之后，网络调试助手中，会自动显示开发板的IP地址。（参见图右侧）
 
.
### 3. 通过WIFI路由器后台管理页面，获取开发板的IP地址
登录WIFI路由器的后台管理端，也可以查看到开发板的IP地址。一般来说，在您的WIFI路由器后台能看到所有已经连入路由器的设备列表。在列表中，可以看到类似于以下内容的开发板设备信息：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=1b24922a6fa82b00e4ebc07e72d4aceb)</center>

列表中的第一行： ```X31-cc8da2c95958``` 这个是设备的名称。所有开发板设备都以X31开头。
列表中的第二行：```192.168.5.178``` 这个是开发板的IP。通过这个IP就可以访问到设备的后台页面了，格式为：
<center>```http://192.168.5.178/mgr```</center>
设备后台界面大致如下：
 
  ![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=b17373e3a19186bed1fe6a4fe553bcf6)
  
.
### 4. 通过开发板显示屏查看WIFI的IP地址（仅限带显示屏的硬件版本）
开发板上连接了显示屏时，也可以在显示屏中直接查看当前WIFI的IP地址：

<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=b799dfdd7b0b2bd2ef7a49b65934b02e)</center>
.
开发板显示屏左右两侧，各有一个轻触按键。轻按两侧按键，可以切换显示屏的信息。
显示屏左上角第一个数字是“屏幕号”，您可以将显示屏切换到第2屏，查看WIFI连接信息。

> ###注意事项
（1）获取开发板IP地址一般只用于产品开发/调试阶段。产品开发/调试完成后，最终用户一般不需要关心开发板的IP地址。
（2）为了方便开发，可以在WIFI路由器上将开发板的IP地址，分配为一个固定的地址（一般在路由器的DHCP选项中设置）。



### 配置开发板接口信息
获取到开发板的IP地址之后，您就可以在浏览器上输入以下地址，登录到开发板的后台管理界面了。比如，假设您的开发板IP地址是192.168.7.170，那么您可以在浏览器上输入以下地址：
  <center>`http://192.168.7.170/mgr`</center>

> 注意：要确保您的电脑与您的设备处于同一个网段，否则无法登录设备后台。一般可以使用ping命令进行测试：
`ping 192.167.7.170`（ping命令的具体用法，请自行百度）。
如果您的电脑与开发板连入的是同一个WIFI热点，但通过IP仍然无法登录设备的后台页面，此类问题通常是：您的电脑连接的是WIFI路由器的5G网络，而设备连接的是2.4G网络，由于您的路由器设置的原因，5G网络与2.4G网络不能互通导致的。）


输入以上地址，并按下回车键，浏览器会提示您输入**管理员用户名**与**管理密码**。开发板默认的**管理员用户名**是**admin**，默认的**管理密码**也是**admin**，如下图所示：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=0feb615a37455e240d8d6c45bbdaf84b)</center>

输入登录用户名、密码之后，点击“**登录**”按钮，将进入后台的**设备管理器页面**：
  
  <center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=cb3d9fde8407683b3c99623aa12ab343)</center>


点击进入“**接口参数配置**”子页面。此页面内容稍多，作为入门操作，只需要关注前三个项目就可以了：
  <center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=047ebeb931804d2851499289dee04253)</center>

  
- “**接口地址设置**”：这里填写您自己开发的HTTP接口地址 或 TCP服务器地址。
如果您对WEB开发比较熟悉，可以搭建一个HTTP Server接收数据，将接口的标准HTTP URL地址填写到**接口地址**框中就可以了。
如果您对C/S开发比较熟悉，也可以搭建一个TCP Server接收数据。将TCP Server的地址、端口号，按以下示例格式填写即可：`tcp://192.168.7.170:6888`

- “**接口请求方式**”：这里有GET/POST两种方式（只限HTTP方式填写）。一般在开发调试阶段，可以选用相对简单的GET方式。
- “**Content-Type**”：这里设置以什么方式打包数据（只限HTTP方式填写）。一般情况下选择**application/x-www-form-urlencode**就可以。当然，如果您喜欢的话，也可以选用**application/json**格式获取数据。

配置完基本的接口信息之后，点击页面最下方的“保存”按钮，完成最终的配置。



### 服务器端接收推送消息
完成初步的用户接口信息配置之后，将开发板断电重启。
  
开发板重启后，首先会尝试连接您提供的WIFI热点信息。当开发板成功连入的WIFI热点之后，将向您的接口推送一条“**消息:100 - WIFI已联网**”的**推送消息**。
  
如果您选择的是以**HTTP接口的application/x-www-form-urlencode方式**接收数据的话，开发板将模拟HTTP页面的FORM表单提交，向您的接口推送第一条消息：
  ```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="100">
	<input name="ip" value="192.168.7.170">
	<input name="ssid" value="mywifi">
	<input name="dbm" value="61">
</form>
```
您可以在HTTP request对象中获取到上面的各项参数，参数的具体释义如下：
  
 | 参数名  | 参数值  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |100|数值型|消息ID|
|ip  | 192.168.7.170 |字符型|开发板当前IP地址|
|ssid |mywifi |字符型|开发板当前连入的WIFI名|
|dbm | 55  |数值型|开发板当前连的WIFI信号强度|


如果您选择的是以**HTTP接口的application/json方式**接收数据的话，您将在HTTP request中获取到**JSON**格式的数据：

 ``` 
 {
  "devId": "498060912345",
  "type": 100,
  "ip": "192.168.7.170",
  "ssid": "mywifi",
  "dbm": 61
} 

 ```
 
如果您选择的是以**TCP接口**接收数据的话，将在您的TCP Server端中获取到**JSON**格式的数据：
```
{"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":61}\x11\x12
```






### 功能概述
“**接口信息配置**”功能用于给开发板配置基本的接口信息，以便于将开发板接入到您指定的接口或第三方平台。
  目前，开发板支持http接口、https接口以及tcp接口，共三种接口类型。
  
由于接口配置信息功能的内容较多，我们将用专门的章节各您说明功能中，各个部分的使用方法。

#### 接口配置信息界面：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=dd1741f2bcc1f630504725405bba3e92)</center>




### 接口地址设置
“**接口地址设置**”文本框用于填写您的接口地址信息或第三方平台的接口信息。


#### 接口地址设置界面：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=d50cffff12be700872380d1a2a315f30)</center>

_
“接口地址设置”文本框中，可以填写您要接入的接口地址。接口地址可以是 http:// 开头或 https:// 开头的HTTP接口，也可以是 tcp:// 开头的 TCP接口。
  
#### HTTP接口填写说明：
对于http接口，一般填写的接口地址样例为：
<center>`http://www.domain.com/server/inf`</center>
对于https接口，接口地址样例为：
<center>`https://www.domain.com/server/inf`</center>
设备中有需要向接口上报的数据时，设备会通过HTTP协议，向您指定的接口自动上报数据。

一般来说，http接口只需要填写一个。但是，“接口地址设置”文本框中，也允许填写多个http接口信息，多个接口之间以“换行”分隔，接口地址样例为：
  <center>
  			https://www.domain01.com/server/inf
  			https://www.domain02.com/server/inf
			https://www.domain03.com/server/inf
  </center>
当您在“接口信息配置”文本框中，同时填写了多个HTTP接口时，设备向接口上报数据时，会以“**轮流上报**”的方式，每次轮流更换一个上报接口进入数据上报。
以上述接口为例：
```seq
开发板-接口:->     消息（1）上报至domain01接口     ->
开发板-接口:->     消息（2）上报至domain02接口     ->
开发板-接口:->     消息（3）上报至domain03接口     ->
开发板-接口:->     消息（4）上报至domain01接口     ->
开发板-接口:->     消息（5）上报至domain02接口     ->
开发板-接口:->     消息（6）上报至domain03接口     ->
```
通常，填写多个HTTP接口轮流上报，一般适用于以下场景：
  
（1）需要将开发板的短信，直接接入到webhook群机器人。为了提高信息的转发速度，您可以在同一个群中，同时创建了多个群机器人，然后，您可以将每一个群机器人的webhook地址，分别填写到“接口信息配置”文本框中，这样，当开发板在向webhook上报数据时，便会利用多个群机器人，逐一轮流向群中上报信息。
  
（2）在某些场景中，您可以利用http轮流上报的特性，实现http访问的负载均衡。当有多个开发板需要同时向某一个http接口上报数据时，为了避免http接口服务器在同一时间内的数据访问的压力过大，您可以设置多组http接口服务器，共同接收来自开发板的HTTP数据上报，从而实现将HTTP访问压力，均衡负载到多个HTTP接口服务器上。

> **注意：**
（1）同时填写多个http接口时，开发板只能以“轮流上报”的方式，逐一向各个接口上报数据。目前，开发板暂不具备向多个接口“同时上报”的能力，后续的版本中可能增加此类功能，如有需求请关注“版本变更履历”一节。

>  （2）一般而言，我们不推荐您使用https接口。因为，https接口仅能做到数据的“防监听、防篡改”，但并不能做到数据的“防伪造”。实际上，您可以用任意一款工具，模拟开发板的数据上报格式，向您的https接口上报数据。您的接口收到数据后，难以分辨当前上报的数据是开发板上报的真实数据，还是恶意的伪造数据。

>  所以，如果对上报的数据有较高的安全要求时，我们推荐您使用http接口，同时开启开发板的“数据加密”功能（在密码管理中）来代替https接口。开发板开启“数据加密”功能后，可以实现数据的“防监听、防篡改、防伪造”。同时，又利用了http接口的轻量性特点，让开发板可以较快的速度，与http接口完成数据交互。

>  我们强烈不推荐，将https接口 与 “数据加密”功能同时开启使用。因为，这将较大程度上的影响开发板的运行效率，进而影响开发板运行的稳定性。

>  最后，在必须使用https接口的场景中，您需要确认https接口的SSL安全协议，必须是v1.2版本。（v1.1或v1.3均不支持）


------------

> **HTTP接口的技术限制：**

>  （1）由于开发板工作于“内网”，开发板本身通常无法获得公网IP地址，所以，使用HTTP接口时，只能由开发板向接口进行“单向的”数据上报。
如果需要远程对开发板进行控制（向开发板发送控制指令等），则需要借助DDNS等技术，将开发板反向映射到一个公网地址，然后通过DDNS的公网地址控制开发板。具体所DDNS涉及的内网映射内容，超出了本文的范围，请您自行百度搜索。
（2）当开发板仅使用4G网络与接口通讯，而本身没有连入WIFI网络时，开发板自身的OTA（设备固件空中升级）功能，无法被启用。只有正确的连入的WIFI网络，开发板才能执行在线的固件升级。


#### TCP接口地址的填写说明：

在对于tcp接口，一般填写的接口地址样例为：`tcp://www.domain.com:8888` 
  
或者使用IP的地址样例： `tcp://10.235.6.98:8888`

tcp接口地址由 tcp:// 固定格式开头，中间填写TCP接口的域名或IP地址，然后填写“TCP接口的端口号”，TCP接口域名（或IP）与端口号之间，以“冒号”分隔。
  
TCP接口地址格式如下：`tcp://[TCP接口域名或IP]:[端口号]` 
  

> **注意：**
>  （1）TCP接口地址，只允许填写一个。填写多个TCP接口地址，无效。
  
>  （2）TCP接口也允许开启开发板自身的“数据加密”功能。更多内容，请参见“数据加密”相关章节。
  
>  （3）由于TCP通讯的技术原理与HTTP不同，TCP接口天然具备了开发板与TCP接口之间的双向通信功能。即在TCP接口通讯建立完成之后，开发板即可以向TCP接口上报数据，同时，TCP接口端也可以随时向开发板下达控制指令，这样，就方便的完成了接口与开发板之间的双向通信。

>  （4）使用TCP接口时，开发板即可以通过WIFI网络向TCP接口上报数据，也可以通过手机卡自身的4G网络向TCP接口上报数据。

------------

> **TCP接口的技术限制：**

>  在当前的版本中，使用TCP接口将有如下的限制：
  
>  （1）当开发板仅使用4G网络与接口通讯，而本身没有连入WIFI网络时，开发板自身的OTA（设备固件空中升级）功能，无法被启用。只有正确的连入的WIFI网络，开发板才能执行在线的固件升级。







### HTTP接口设置
当您的接口使用的是HTTP接口时，通过“**HTTP接口设置**”功能可以对HTTP协议的细节，完成进一步的设置。
  

#### HTTP接口设置界面：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=045557a92489f8ab23049b2d377b866a)</center>


（1）**HTTP请求方式：**用于设置开发板向接口发送HTTP请求时，可以通过 GET 或是 POST 两种方式提交数据。一般来说，在正式的使用环境中，我们**推荐您使用POST**，而GET方式由于受到参数长度的限制，不适合发送数据量较多的数据。GET方式一般用于初步的开发调试中使用。

（2）**Content-Type：**Content-Type可以设置HTTP提交数据的方式，有两种选择分别是：FORM 或 JSON。

如果您选择了FORM，则开发板向您的接口提交数据时，模拟的是HTTP FORM表单，您的接口一侧收到数据后，可以通过 request 对象获取开发板提交过来的数据，比如在Java中，您可以使用 request.getParameter("参数名") 的方式，获取到数据。
  
如果您选择了JSON，则开发板向您的接口提交数据时，您的接口一侧可以通过读取 request 流的方式，获取到一个包括所有数据的完整的JSON串。比如在Java中，示例代码如下：
  ```java
  String contentType = request.getHeader("Content-Type");
  if (contentType.contains("application/json")) {
  	BufferedReader br = null;
  	try {
		  br = new BufferedReader(new InputStreamReader(request.getInputStream(), "UTF-8"));
		  StringBuilder sb = new StringBuilder();
		  String s;
		  while ((s = r.readLine()) != null) {
			  sb.append(s);
		  }
		  String jsonStr = sb.toString();
		  System.out.println("Json数据是：" + jsonStr);
	  } finally {
	  	if (br != null)  r.close();
	  }
  } 
  ```
  
注意：如果您选择了 GET + JSON，那么您在接口一侧需要使用 request.getParameter("p") 来获取到GET中的数据。这里的“**p**”，是开发板在GET方式中提交数据时的“固定参数名”。所有数据组装成JSON串后，会放在“p”参数中向您的接口中提交。以100消息为例，“p”参数获取到的参数内容，格式如下：
```json
{ "devId": "498060912345", "type": 100, "ip": "192.168.7.170", "ssid": "mywifi", "dbm": 61, "netCh": 0 } 
```

无论如何，GET + JSON 的方式，一般只应用于内部调试阶段，正式环境中都不推荐使用这种组合。
  
**Content-Type**，无论您选择 FORM 或是 JSON ，在技术本身的优缺点层面上并没有差异。您可以根据您自己的需要自行选择。
  
（3）**请求频率：**一般来说，设置为“无限制”即可。在对接某些第三方平台时（比如对接webhook机器人），有些第三方平台，会限制HTTP请求的频率。比如，钉钉和企业微信，都要求机器人webhook地址的请求频率，不能超过每分钟20次，否则会触发惩罚机制。在这种情况下，您可以将此选项设置为：限制并每分钟不超过20次，即可。
  
（4）**HTTP附加头：**一般来说，这个选项用不到。在某些特殊的情况，比如您的接口中开启了HTTP基本身份验证（Basic auth），此时如果用户通过浏览器直接访问接口时，浏览器会弹出“请输入访问的用户名、密码”的提示框，而您希望开发板向接口上报数据不受这个限制，此时，您就可以将HTTP认证信息，附加到HTTP头信息中，类似以下格式：
```
"Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ="
```
具体关于HTTP头信息的用法，您可以根据自己的需要自行设计。




### TCP接口设置
当您的接口使用的是TCP接口时，通过“**TCP接口设置**”功能可以对TCP接口的细节，完成进一步的设置。
  

#### TCP接口相关的设置界面：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=db8497e43ded85e31b70221dc7feaab3)</center>

（1）**联网卡槽：**与HTTP接口不同的是，通过TCP接口上报数据时，开发板允许 **WIFI** 或 **手机卡自身的网络** 两种方式，进行数据上报。默认情况下，如果开发板已经连入了WIFI网络，则优先使用WIFI网络向接口上报数据。如果WIFI网络临时断开，则开发板会默认尝试开启手机卡网络进行数据上报，并直到WIFI网络恢复后，再重新切换回WIFI网络。
  
当通过手机卡网络上报数据时，会消耗手机卡的流量并可能产生流量费用，有时这并不是您所期望的（比如某些卡的流量费用相当昂贵），此时您可以通过本选项进行进一步的控制。本选项共包括以下几种选择：
  
1. 全部允许     即：允许在没有WIFI网络的环境中，使用 卡1 或 卡2 的手机卡流量。
2. 仅允许卡槽１   即：在没有WIFI网络的环境中，只允许卡槽1中的卡，尝试开启流量功能。
3. 仅允许卡槽２   即：在没有WIFI网络的环境中，只允许卡槽2中的卡，尝试开启流量功能。
4. 全部禁止     即：只允许使用WIFI网络转发数据，手机卡网络一律不允许使用。
  

> **注意：**
当开发板的所有网络都无法连接时，开发板的数据上报将被“暂停”。
“暂停”期间的需要上报数据并不会丢失（即使在“暂停”期间开发板被人为重启），当网络连接恢复后，所有“暂停”期间未能上报的数据，会重新向接口逐一完成上报。


（2）**联网顺序：**WIFI已成功联网的情况下，总是优先通过WIFI上报数据。当WIFI未联网的状态下，默认情况下，开发板会随机使用卡1或卡2的手机卡网络进行联网。




### 接口消息设置
开发板自身在运行期间会发生多种“状态变化”，当某些“状态”发生变化时，开发板就会触发消息上报的处理，将相关状态数据打包后主动向接口上报。
“**接口消息设置**”用于设置将开发板的哪些消息，允许向接口上报。一般来说，这里只需要设置您的接口所需要关心的消息即可，对于您不关心的消息，可以选择不上报。
  

#### 接口消息设置界面：
<center>![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=7dab474c94b70d31b46224bf4555960f)</center>

#### 一、已联网消息：
（1）**100（WIFI已联网）消息：**当开发板正确连入了您指定的WIFI网络时，开发板将向接口上报100消息，表示开发板本身已经通过WIFI联网成功。
（2）**101（卡槽1已联网）消息：**当开发板已经连入了卡槽1网络时，开发板将向接口上报101消息，表示开发板本身已经通过卡槽1联网成功。
（2）**102（卡槽1已联网）消息：**当开发板已经连入了卡槽2网络时，开发板将向接口上报102消息，表示开发板本身已经通过卡槽2联网成功。

> **注意：**
由于目前HTTP接口只允许使用WIFI网络，所以，使用HTTP接口时，将只能够获取到100消息。如果您的接口是TCP接口，则可能会获取到100、101、102三种消息中的任意一种。

------------

> **【小提示】**
开发板在通电开机之后，首先做的第一件事情是尝试完成开发板的联网。所以，合理利用100、101、102消息，可以实现监测开发板是否已经开机。

  

#### 二、SIM卡消息：
（1）**202（SIM卡基站注册中）消息：**当您向开发板插入SIM卡时，开发板会对SIM卡进行初始化。SIM卡初始化过程包括监测SIM卡本身是否能正常工作，以及驱动SIM卡向运营商基站注册等工作。开发板在执行SIM卡初始化的动作之前，会首先向接口上报202消息，提示SIM卡已经插入，并且正在进行初始化。
  
（2）**203（SIM卡ID已经获取）消息：**SIM卡的ICCID、IMSI、MSISDN是SIM卡的三个基本参数。当SIM卡初始化完成后，会向接口上报关于当前SIM卡的ICCID、IMSI、MSISDN三个基本信息。
  
>  **ICCID**为SIM本身的集成电路ID。此ID通常被印刷在SIM的背面，并且在SIM卡本身更换时（如补卡）发生改变。
  **IMSI**为SIM卡的运营商识别ID。此ID是与电话号码一一对应的（但IMSI不是电话号码），IMSI可以在逻辑上唯一标识一张卡，即使SIM卡本身发生更换（如补卡后），IMSI也不会改变。
  **MSISDN**为通常意义上的“手机号”，MSISDN由运营商在发卡时进行预置。但是随着客户隐私保护的不断深入，越来越多的新卡，在出厂时并不会预置“手机号”。所以，在很多的手机卡上 MSISDN 通常都是空白值。
  
（3）**204（SIM卡已就绪）消息：**当接口收到204消息时，表示SIM卡已经完成了所有的初始化工作，SIM卡本身已经可以正常的接打电话、收发短信了。
  
（4）**205（SIM卡已弹出）消息：**如果在开发板开机的过程中，用户主动的取走了开发板中的SIM卡，则对应的接口上会收到205消息，表示SIM已经被取出。
  
（5）**209（SIM卡异常）消息：**如果开发板无法正确的完成对SIM卡的初始化工作，则会向接卡上报209消息。通常而言，如果开发板上报209消息，一般可能是如下几种原因：
（5.1）SIM卡欠费停机。补缴话费后可以自动恢复；
（5.2）SIM卡插卡不良。未能正确插卡（如SIM卡与卡套安装不良）；
（5.3）SIM卡已损坏。这里指SIM的物理损坏，需考虑重新补卡；
（5.4）SIM卡已被封停。具体原因请咨询手机卡的运营商；
  
> **注意：**
203、204消息一般是大致在**同一时间内**先后接收到，但是接收的顺序可能是不确定的。即，有可能先接收到204消息，然后再接收到203消息。
  

#### 三、通讯模组消息：
（1）**301（通讯模组错误）消息：**当您向开发板插入SIM卡时，开发板会首先对通讯模组进行初始化。如果通讯模组初始化失败，开发板会向接口发送301消息。一般而言，如遇301错误，通常为开发板损坏。
    

#### 四、命令应答消息：
您可以通过向开发板发送“命令”，让开发板完成命令指定的动作，比如通过命令获取开发板的当前状态，或通过命令控制开发板向外发送短信或拨打电话等等。
（1）**401（命令已收到）消息：**当您向开发板发送命令后，如果开发板收到了您的命令，会立即返回401消息，表示命令已经成功接收。
  
（2）**402（命令已处理）消息：**当您向开发板发送命令后，如果开发板对您的命令已经处理完成，会立即返回402消息，表示您的命令已经执行完成。
  

#### 五、短信消息：
（1）**501（新短信）消息：**当开发板上的SIM卡收到了新的短信时，会向接口上报501消息。501消息中会包括短信号码、短信内容、短信时间以及卡槽编号等必要的信息。
  
（1）**502（短信外发成功）消息：**当您通过控制指令遥控开发板的SIM卡向外发短信时，如果短信发送成功，则开发板会向接口上报502消息。需要注意的是，如果外发短信不成功，则开发板不会给出任何消息提示。在实际的使用过程中，当外发短信的控制指令被成功执行起算，超过30秒仍然收不到502消息，则一般认为是短信外发失败。如果SIM卡在某个时点之后，短信外发始终都不能成功，则优先考虑SIM卡本身话费是否充足（外发短信一般需要在运营商层面扣除话费）。
  

#### 六、电话消息：
（1）**601（来电振铃）消息：**当开发板上的SIM卡收到了来电，本机处于来电振铃状态时，开发板会向接口上报601消息，表示有电话正在呼入，等待接听中。
  
（2）**602（来电接通）消息：**当开发板正在处于来电振铃状态时，给开发板发送“接听来电命令”时，开发板会立即接听本次来电，并向接口端上报602消息，表示本次来电已成功接听。
  
（3）**603（对方挂断来电）消息：**当开发板上的SIM卡收到了来电，在呼叫方挂断电话之后（本次来电结束），开发板会向接口上报603消息。603消息中会包括来电号码、来电时间、对方挂断时间以及卡槽编号等必要的信息。
  
（4）**620（去电拨号中）消息：**当开发板的电话处于空闲状态时，给开发板发送“电话外呼拨号命令”时，开发板会首先尝试向对方号码拨打电话，在处于拨号中的环节时，开发板会向接口上报620消息，表示正在拨打对方号码。
  
（5）**621（去电对方振铃中）消息：**当开发板外呼拨号完成后，对方手机开始振铃时，开发板会向接口上报621消息，表示电话外呼拨号已经成功，对方手机正在振铃中，等待对方接听。
  
（6）**622（去电已接通）消息：**当开发板外呼拨号对方振铃后，对方主动接听了本次来电，开发板会向接口上报622消息，表示对方已经接听电话。
  
（7）**623（去电已挂断）消息：**当开发板外呼通过中，对方主动挂断电话，或开发板自身通过“本地挂机命令”主动挂断了电话，开发板会向接口上报623消息，表示本次通话已经结束。
  
（8）**641（通过中本地按键）消息：**当开发板处于通话中的状态时，开发板自身通过“本地按键命令”按下了某些按键，开发板会向接口上报641消息，表示开发板自身在通话中的按键动作已经完成。
  
（9）**642（通过中远程按键）消息：**当开发板处于通话中的状态时，对方在电话机中按下了某些按键时，开发板会向接口上报642消息，表示对方在通话中的按键已完成。
    

#### 七、电话控制回应消息：
（1）**681（外呼拨号成功）消息：**向开发板发送“电话外呼拨号命令”时，开发板会立即控制手机卡向指定号码进行拨号。当拨号成功时，开发板会向接口上报681消息，表示电话外呼拨号已经成功。
  
（2）**682（外呼拨号失败）消息：**向开发板发送“电话外呼拨号命令”时，开发板会立即控制手机卡向指定号码进行拨号。当拨号失败时，开发板会向接口上报682消息，表示本次电话外呼拨号失败。（可能的原因一般包括：卡故障、卡欠费等）
  
（3）**684（接听成功）消息：**当开发板处于“来电振铃”状态时，向开发板发送“电话接听命令”，开发板会立即尝试接听本次来电。当来电接听成功时，开发板会向接口上报684消息，表示本次来电已经成功接听。
  
（4）**685（接听失败）消息：**当开发板处于“来电振铃”状态时，向开发板发送“电话接听命令”，开发板会立即尝试接听本次来电。当来电接听失败时，开发板会向接口上报685消息，表示本次来电未接成功接听。
  
（5）**687（TTS播放成功）消息：**当开发板处于“通话中”状态时，向开发板发送“TTS播放命令”，开发板会立即向本次通话中的对方播放指定的语音内容。当语音内容被成功播放时，开发板会立即向接口上报687消息，表示指定的语音内容已经开始播放。
  
（6）**688（TTS播放失败）消息：**当语音内容被不能成功播放时，开发板会立即向接口上报688消息，表示指定的语音内容未能成功播放。（比如不在通话中状态等）
  
（7）**689（TTS播放结束）消息：**当语音内容被完整的播放完成后，开发板会立即向接口上报689消息，表示指定的语音内容已经完整的播放完成。

#### 八、其它消息：
（1）**998（PING）消息：**开发板在运行期间，会定时向接口上报PING消息。表示开发板已经开机且工作正常。通常来说，HTTP接口一般不需要处理998消息。但TCP接口则必须接收本消息，并以此判断客户端（开发板一侧）的TCP链接正常。在TCP接口模式下，998消息无论您是否勾选，998消息会始终向您的TCP接口推送。
  
> **【小提示】**
通常可以用定时监测998消息的方法，确定开发板是否已经处于开机工作中的状态。比如，可以将PING消息设置为每60秒主动触发一次，然后接口端如果连续2次或3次都没有接收到998消息，则可以认为开发板网络断开且无法联网了 或是 开发板关机了。




### 关于接口类型
### 开发板支持的接口类型
在当前发布的固件中，开发板支持HTTP、TCP两种接口。如果您熟悉WEB开发，您可以搭建一个HTTP Server，并最终向开发板提供一下标准的HTTP URL地址，做为数据接收的地址。
如果您熟悉C/S开发，您可以搭建一个TCP Server，并按下述格式向开发板提供TCP Server的通信地址和端口号：`tcp://192.168.7.101:3888`
如果是用于生产环境，有条件的话优先推荐使用TCP接口。TCP接口功能强大，速度快，稳定性好。次选HTTP POST+FORM接口，这个接口的简单易用、开发速度快、兼容性好。

### 接口间的优缺点分析
#### HTTP接口
HTTP接口采用了标准的HTTP通信协议，支持GET、POST两种方式传递数据。
**优点：**使用简单、兼容性好。
**缺点：**1.开发板必须连入WIFI热点，开发板才能执行OTA升级。
2.除非您的HTTP Server与开发板处于同一个网段内，否则的话，如果您的HTTP Server搭建在云端公网，需要向开发板反向发送**控制指令**会比较困难。通常，您需要借助DDNS反向解析等技术，才能实现**控制指令**从云端公网至局域网的反向数据传送。
   
##### HTTP接口哪一种模式最值得推荐？
HTTP接口支持GET、POST两种方式传递数据，具体的数据封装支持FORM、JSON两种。从设备稳定性角度而言，用于生产环境时，我们最推荐的是 POST+FORM 这种组合。这种组合速度快、占用资源少、兼容性好。
   

#### TCP接口
TCP接口采用了基于JSON格式的私有数据协议，在每条JSON消息之后增加2个字节的二进制结束符（0x11 0x12）作为消息的结束标志。
**优点：**1.支持WIFI + 手机卡网络智能联网调度。即，在有WIFI网络时，数据传送优先使用WIFI，当WIFI异常断开后，开发板会自动尝试通过手机卡网络传送数据，直到WIFI网络恢复正常。
2.支持纯手机卡网络传送数据，并可以在多个卡槽之间（如果开发板上同时插了多张手机卡），进行智能联网调度。开发板中的任何一张卡能正常联网，即可保持正常的数据传送。
3.反向发送**控制指令**简单。即使您的TCP Server搭建在云端公网，从云端公网向局域网中的开发板发送**控制指令**，也十分的容易。
**缺点：**1.相对于HTTP接口方式，TCP接口本身开发调试，都具有一定的复杂性。
2.在没有连入WIFI网络的情况下，开发板不能执行OTA（设备固件空中升级）功能。

如果您喜欢TCP接口方式，我们推荐您使用**网络调试助手**这个工具辅助您的开发。此工具的下载地址是：http://www.cmsoft.cn/resource/102.html
  
#### 最不推荐的接口模式是什么？
如果是用于生产环境，我们最不推荐的是HTTPS接口。由于HTTPS接口要进行大量加密、解密运算，对设备的负担较重，并不利于设备的长期稳定运行。如果您对数据传输加密有要求，建议您可以使用开发板自带的AES通讯加密功能，即HTTP+AES或TCP+AES。



### 开发板数据交互指南
### 概要
开发板本身属于**资源受限的**嵌入式开发设备，开发板每一次向服务器端发送HTTP请求时，都会对开发板自身产生较高的资源占用。其中HTTPS占用最高，每次的HTTPS请求几乎需要占用50％左右的资源（大量的数据RSA加解密操作）。相较于HTTPS请求，每一次的HTTP请求的资源占用会小很多，而TCP接口的资源占用最小。
所以，当接口端（服务器端）收到开发板推送的数据后，应在**最短的时间内**完成数据接收并应答，尽快结束本轮的数据上报动作。
  ####以下是正确的应答流程：

  ```plantuml
@startuml
开发板 -> 用户接口:      （1）上报HTTP请求
|||
用户接口 <--  用户接口:  （2）缓存数据
note right
将开发板上报的数据进行缓存
（此时不要进行业务处理）
end note
|||
开发板 <- 用户接口 :    （3）回应HTTPCode : 200    
note left
确保在最短时间内
完成应答
end note
|||
用户接口 <-- 用户接口 :  （4）接口端业务处理
note right
获取缓存的数据，
进行后续的业务逻辑处理
end note
@enduml
```

  
  ####以下是错误的应答流程：
```plantuml
@startuml
participant 开发板

开发板 -> 用户接口:   上报HTTP请求
activate 用户接口

用户接口 -> 接口端处理A:   <<后续业务逻辑>> 
activate 接口端处理A

接口端处理A -> 接口端处理N...:   <<后续业务逻辑>> 
activate 接口端处理N...
|||
接口端处理N... --> 接口端处理A:  业务处理完成
deactivate 接口端处理N...

接口端处理A --> 用户接口:  业务处理完成
deactivate 接口端处理A

用户接口 -> 开发板:  回应HttpCode:200 
destroy 用户接口
note left
响应时间过长会导致
开发板上报超时
或开发板通道阻塞
end note
@enduml
```



### 监测设备可用状态
### 概要
在开发服务器端时，需要在服务器端获得设备的工作状态，通常有两种方式：
1）主动给设备发送状态查询指令 
2）被动接收设备上报的PING消息
两种方式的使用场景不同。服务器端主动给设备发送状态查询指令，适用于**偶尔**获取设备的工作状态时使用，而被动接收设备上报的PING消息，则适用于**长时间**不间断的对设备工作状态进行监听。
  
  ###一、两种获取方式对比
  ####1. 主动查询（Request-Response 模式）
##### 使用场景
需要即时获取设备当前状态时使用（例如：用户手动刷新界面、故障诊断时）
##### 工作原理
服务器向设备发送 stat 等指令 -> 设备立即响应状态数据
##### 注意事项
▸ 每次查询会导致设备暂停当前任务处理请求（约 1000ms 阻塞）
▸ 严禁高频使用（如：定时循环查询），这会导致设备持续卡顿
▸ 典型错误示例：setInterval(getDeviceStatus, 10000) // 每10秒轮询

  ####2. 被动监听（Heartbeat 模式）
##### 使用场景
需要 7×24 小时持续监控设备在线状态时使用
##### 工作原理
设备定期（如 60 秒）自动发送PING报文 -> 服务器记录最后活跃时间
##### 技术优势
▸ 无设备端阻塞（后台低功耗运行）
▸ 网络开销小（每次报文 < 1KB）
  
  ####主动查询使用限制
  | 允许场景  |  禁止场景 |
| ------------ | ------------ |
| 心跳超时（3 次未收到 PING）  |  定时轮询（即使间隔 600 秒以上）  |
| 用户主动操作  | 批量设备同时查询  |

 

  ####被动PING消息接收流程
***1）正常状态***：依赖设备 PING 报文更新最后活跃时间
***2）当连续 3 次未收到 PING ***：假设PING消息间隔60秒，则 60（间隔秒数） * 3（次） + 8（冗余秒数） = 188秒，188秒内未收到设备上报的PING消息时，触发设备离线提醒。

### 特别说明：
除本文上述的两种监测方式之外，其它监测方法均不推荐，包括且不限于：
1）尝试向设备发送 TCP ping 消息（包括win/linux中的ping命令），监听TCP是否畅通。此方法并不能可靠的监测设备的状态，不推荐使用。
2）尝试定期轮询设备的后台WEB页面（http://192.168.1.50/mgr ）通过是否能访问到后台页面，做为监测设备是否可用的依据，此方法可能会导致设备失去响应，必须严格禁止。
  
合理使用主动查询与被动查询，这种设计既能保证实时性，又避免给设备造成持续性压力。



